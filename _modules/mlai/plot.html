

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mlai.plot &mdash; MLAI 0.1.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=92734c54"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            MLAI
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to MLAI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tenets.html">Project Tenets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Information:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cip/index.html">Code Improvement Proposals (CIPs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../backlog/index.html">Project Backlog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MLAI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">mlai.plot</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for mlai.plot</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">mlai.plot</span>
<span class="sd">=========</span>

<span class="sd">Plotting utilities and visualization functions for the MLAI library.</span>

<span class="sd">This module provides a wide range of plotting functions for illustrating</span>
<span class="sd">machine learning concepts, model fits, matrix visualizations, and more.</span>
<span class="sd">It is designed to support both teaching and research by offering</span>
<span class="sd">publication-quality figures and interactive visualizations.</span>

<span class="sd">Key features:</span>
<span class="sd">- Matrix and covariance visualizations</span>
<span class="sd">- Regression and classification plots</span>
<span class="sd">- Model fit diagnostics (RMSE, holdout, cross-validation)</span>
<span class="sd">- Neural network diagrams</span>
<span class="sd">- Utility functions for figure generation</span>

<span class="sd">Dependencies:</span>
<span class="sd">- numpy</span>
<span class="sd">- matplotlib</span>
<span class="sd">- (optional) daft, IPython, mpl_toolkits.mplot3d</span>

<span class="sd">Some functions expect models following the MLAI interface (e.g., LM, GP).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.animation</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">animation</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">IPython</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.mplot3d</span><span class="w"> </span><span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>


<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">daft</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">mlai</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ma</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.linear_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">LM</span>

<span class="c1"># Check for GPy availability</span>
<span class="n">GPY_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">GPy</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">GPY_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>


<span class="n">tau</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="n">three_figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">two_figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">one_figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">big_figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">wide_figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>
<span class="n">big_wide_figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">hcolor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span> <span class="c1"># highlighting color</span>

<span class="n">notation_map</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;variance&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\alpha&#39;</span><span class="p">,</span>
           <span class="s1">&#39;lengthscale&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\ell&#39;</span><span class="p">,</span>
           <span class="s1">&#39;period&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;\omega&#39;</span><span class="p">}</span>

<div class="viewcode-block" id="pred_range">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.pred_range">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">pred_range</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">portion</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">randomize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a range of prediction points based on the input array x.</span>
<span class="sd">    :param x: Input array (1D or 2D, numeric).</span>
<span class="sd">    :param portion: Fraction of the span to extend beyond min/max (default: 0.2).</span>
<span class="sd">    :param points: Number of points in the generated range (default: 200).</span>
<span class="sd">    :param randomize: If True, randomly shuffle the generated points (default: False).</span>
<span class="sd">    :returns: Numpy array of prediction points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input array x must not be empty.&quot;</span><span class="p">)</span>
    <span class="c1"># Flatten to 1D if possible</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input array x must be numeric.&quot;</span><span class="p">)</span>
    <span class="n">span</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="n">xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">-</span> <span class="n">portion</span> <span class="o">*</span> <span class="n">span</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">+</span> <span class="n">portion</span> <span class="o">*</span> <span class="n">span</span><span class="p">,</span> <span class="n">points</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">randomize</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">xt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">xt</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">span</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">points</span><span class="p">)</span></div>


<span class="c1"># def write_plots(filename=filename, filebase, directory=None, width=700, height=500, kwargs):</span>
<span class="c1">#     &quot;&quot;&quot;Display a series of plots controlled by sliders. The function relies on Python string format functionality to index through a series of plots.&quot;&quot;&quot;</span>
<span class="c1">#     args = collections.OrderedDict(kwargs)</span>
    
<span class="c1">#     def write_figure(filebase, directory, **kwargs):</span>
<span class="c1">#         &quot;&quot;&quot;Helper function to load in the relevant plot for display.&quot;&quot;&quot;</span>
<span class="c1">#         filename = filebase.format(**kwargs)</span>
<span class="c1">#         if directory is not None:</span>
<span class="c1">#             filename = directory + &#39;/&#39; + filename</span>
<span class="c1">#         return &quot;&lt;img src=&#39;{filename}&#39;&gt;&quot;.format(filename=filename)</span>
<span class="c1">#     meta = &#39;{data-transition=&quot;None&quot;}&#39;</span>
<span class="c1">#     out = &#39;### &#39; + meta</span>
<span class="c1">#     for name, val in kwargs.items():</span>
<span class="c1">#         if isinstance(val,list) or isinstance(</span>
<span class="c1">#         out += &#39;\\n\n&#39; + write_figure(filebase=filebase, directory=directory, **kwargs) + &#39;\\n\n&#39;</span>
<span class="c1">#         for </span>
<span class="c1">#     interact(show_figure, filebase=fixed(filebase), directory=fixed(directory), **kwargs)</span>


<div class="viewcode-block" id="matrix">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.matrix">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">bracket_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
           <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span>
           <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;values&#39;</span><span class="p">,</span>
           <span class="n">colormap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">highlight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">highlight_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">highlight_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">highlight_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
           <span class="n">highlight_color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
           <span class="n">prec</span> <span class="o">=</span> <span class="s1">&#39;.3&#39;</span><span class="p">,</span>
           <span class="n">zoom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">zoom_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">zoom_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">bracket_color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
           <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a matrix with optional highlighting and custom brackets.</span>

<span class="sd">    :param A: Matrix to plot (2D numpy array or list of lists).</span>
<span class="sd">    :param ax: Matplotlib axis to draw the plot on (optional).</span>
<span class="sd">    :param bracket_width: Width of the bracket lines (default: 3).</span>
<span class="sd">    :param bracket_style: Style of brackets (&#39;square&#39; or &#39;round&#39;, default: &#39;square&#39;).</span>
<span class="sd">    :param type: Display type (&#39;values&#39;, &#39;entries&#39;, etc., default: &#39;values&#39;).</span>
<span class="sd">    :param colormap: Colormap for matrix values (optional).</span>
<span class="sd">    :param highlight: Whether to highlight a row/column (default: False).</span>
<span class="sd">    :param highlight_row: Row to highlight (optional).</span>
<span class="sd">    :param highlight_col: Column to highlight (optional).</span>
<span class="sd">    :param highlight_width: Width of highlight lines (default: 3).</span>
<span class="sd">    :param highlight_color: Color for highlights (default: black).</span>
<span class="sd">    :param prec: String precision for values (default: &#39;.3&#39;).</span>
<span class="sd">    :param zoom: Whether to zoom into a submatrix (default: False).</span>
<span class="sd">    :param zoom_row: Row index for zoom (optional).</span>
<span class="sd">    :param zoom_col: Column index for zoom (optional).</span>
<span class="sd">    :param bracket_color: Color for brackets (default: black).</span>
<span class="sd">    :param fontsize: Font size for text (default: 16).</span>
<span class="sd">    :returns: Matplotlib axis with the matrix plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">colormap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span> 

    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    
    <span class="n">nrows</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ncols</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
  
    <span class="n">x_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">ncols</span><span class="o">-</span><span class="mf">0.25</span><span class="p">])</span>
    <span class="n">y_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">nrows</span><span class="o">-</span><span class="mf">0.25</span><span class="p">])</span>
  
    <span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">handle</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;image&#39;</span><span class="p">:</span>
        <span class="n">handle</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;imagesc&#39;</span><span class="p">:</span>
        <span class="n">handle</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">images</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">flatten</span><span class="p">())])</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncols</span><span class="p">):</span>
                <span class="c1"># Convert to float for proper formatting</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;{val:</span><span class="si">{prec}</span><span class="s1">}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;entries&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncols</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">handle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">))</span>
                    
                <span class="k">else</span><span class="p">:</span>  
                    <span class="n">handle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;patch&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncols</span><span class="p">):</span>
                <span class="c1"># Convert to float for proper color handling</span>
                <span class="n">color_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">([</span><span class="n">i</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span>
                                  <span class="n">width</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">color_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))))</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;colorpatch&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncols</span><span class="p">):</span>
                <span class="c1"># Convert boolean arrays to RGB values (0 or 1)</span>
                <span class="n">rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">])])</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">([</span><span class="n">i</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span>
                                  <span class="n">width</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">rgb</span><span class="p">)))</span>
                
                
    <span class="k">if</span> <span class="n">bracket_style</span> <span class="o">==</span> <span class="s1">&#39;boxes&#39;</span><span class="p">:</span>
        <span class="n">x_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ncols</span><span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
        <span class="n">y_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
<span class="c1">#        for i in range(nrows+1):</span>
<span class="c1">#            ax.add_line(plt.axhline(y=i-.5, #xmin=-0.5, xmax=ncols-0.5, </span>
<span class="c1">#                 color=bracket_color))</span>
<span class="c1">#        for j in range(ncols+1):</span>
<span class="c1">#            ax.add_line(plt.axvline(x=j-.5, #ymin=-0.5, ymax=nrows-0.5, </span>
<span class="c1">#                 color=bracket_color))</span>
    <span class="k">elif</span> <span class="n">bracket_style</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
        <span class="n">tick_length</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">tick_length</span><span class="p">,</span>
                     <span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">tick_length</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">y_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">y_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="n">bracket_width</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bracket_color</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tick_length</span><span class="p">,</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tick_length</span><span class="p">],</span>
                             <span class="p">[</span><span class="n">y_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">y_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="n">linewidth</span><span class="o">=</span><span class="n">bracket_width</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bracket_color</span><span class="p">))</span>
      
    <span class="k">if</span> <span class="n">highlight</span><span class="p">:</span>       
        <span class="n">h_row</span> <span class="o">=</span> <span class="n">highlight_row</span> <span class="k">if</span> <span class="n">highlight_row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;:&#39;</span>
        <span class="n">h_col</span> <span class="o">=</span> <span class="n">highlight_col</span> <span class="k">if</span> <span class="n">highlight_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;:&#39;</span>
        <span class="c1"># Expand &#39;:&#39; to full range</span>
        <span class="k">if</span> <span class="n">h_row</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
            <span class="n">h_row</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrows</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h_row</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">h_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">h_row</span><span class="p">,</span> <span class="n">h_row</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h_row</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">h_row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">h_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">h_row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">h_col</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
            <span class="n">h_col</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncols</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h_col</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">h_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">h_col</span><span class="p">,</span> <span class="n">h_col</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h_col</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">h_col</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">h_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">h_col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">h_col</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">h_col</span><span class="p">]</span>
        <span class="n">h_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">h_row</span><span class="p">]</span>
        <span class="n">h_col</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">h_row</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="n">h_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">h_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
                              <span class="n">h_col</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">h_col</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                              <span class="n">h_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span>
                             <span class="p">[</span><span class="n">h_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">h_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                              <span class="n">h_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">h_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
                              <span class="n">h_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">highlight_color</span><span class="p">,</span>
                               <span class="n">linewidth</span><span class="o">=</span><span class="n">highlight_width</span><span class="p">))</span>
                    
    <span class="k">if</span> <span class="n">zoom</span><span class="p">:</span>      
        <span class="n">z_row</span> <span class="o">=</span> <span class="n">zoom_row</span> <span class="k">if</span> <span class="n">zoom_row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;:&#39;</span>
        <span class="n">z_col</span> <span class="o">=</span> <span class="n">zoom_col</span> <span class="k">if</span> <span class="n">zoom_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;:&#39;</span>
        <span class="c1"># Expand &#39;:&#39; to full range</span>
        <span class="k">if</span> <span class="n">z_row</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
            <span class="n">z_row</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrows</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z_row</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">z_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">z_row</span><span class="p">,</span> <span class="n">z_row</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z_row</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">z_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">z_row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">z_col</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
            <span class="n">z_col</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncols</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z_col</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">z_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">z_col</span><span class="p">,</span> <span class="n">z_col</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z_col</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_col</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">z_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">z_col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">z_col</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">z_col</span><span class="p">]</span>
        <span class="n">z_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">z_row</span><span class="p">]</span>
        <span class="n">z_col</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">z_row</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">x_lim</span> <span class="o">=</span> <span class="p">[</span><span class="n">z_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">z_col</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">]</span>
        <span class="n">y_lim</span> <span class="o">=</span> <span class="p">[</span><span class="n">z_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">z_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span> <span class="c1">#axis ij, axis equal, axis off</span>

             
    <span class="k">return</span> <span class="n">handle</span> </div>



<div class="viewcode-block" id="base_plot">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.base_plot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">base_plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">contour_color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
              <span class="n">contour_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
              <span class="n">contour_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
              <span class="n">contour_markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
              <span class="n">contour_marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
              <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a base contour for a covariance matrix.</span>

<span class="sd">    :param K: Covariance matrix (2D numpy array).</span>
<span class="sd">    :param ind: Indices of variables to plot (default: [0, 1]).</span>
<span class="sd">    :param ax: Matplotlib axis to draw the plot on (optional).</span>
<span class="sd">    :param contour_color: Color for the contour (default: blue).</span>
<span class="sd">    :param contour_style: Line style for the contour (default: &#39;-&#39;).</span>
<span class="sd">    :param contour_size: Line width for the contour (default: 4).</span>
<span class="sd">    :param contour_markersize: Marker size for the contour (default: 4).</span>
<span class="sd">    :param contour_marker: Marker style (default: &#39;x&#39;).</span>
<span class="sd">    :param fontsize: Font size for labels (default: 20).</span>
<span class="sd">    :returns: Matplotlib axis with the contour plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">blackcolor</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">v</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">ind</span><span class="p">][:,</span> <span class="n">ind</span><span class="p">])</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">200</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                      <span class="n">linewidth</span><span class="o">=</span><span class="n">contour_size</span><span class="p">,</span>
                      <span class="n">linestyle</span><span class="o">=</span><span class="n">contour_style</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="n">contour_color</span><span class="p">)</span>
    <span class="n">cent</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">],</span>
                      <span class="n">marker</span><span class="o">=</span><span class="n">contour_marker</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="n">contour_color</span><span class="p">,</span>
                      <span class="n">linewidth</span><span class="o">=</span><span class="n">contour_size</span><span class="p">,</span>
                      <span class="n">markersize</span><span class="o">=</span><span class="n">contour_markersize</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">cent</span><span class="p">)</span>

    <span class="n">thandle</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">thandle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$f_{&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;}$&#39;</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">))</span>
    <span class="n">thandle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$f_{&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;}$&#39;</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">))</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">x_lim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>
    <span class="n">y_lim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span><span class="n">x_lim</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">blackcolor</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y_lim</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">blackcolor</span><span class="p">))</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">cont</span><span class="p">,</span> <span class="n">thandle</span><span class="p">,</span> <span class="n">cent</span> </div>


<div class="viewcode-block" id="covariance_capacity">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.covariance_capacity">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">covariance_capacity</span><span class="p">(</span><span class="n">rotate_angle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span>
                        <span class="n">lambda1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                        <span class="n">lambda2</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                        <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams/gp&#39;</span><span class="p">,</span>
                        <span class="n">fill_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                        <span class="n">black_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                        <span class="n">blue_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
                        <span class="n">magenta_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize the capacity of a covariance matrix by plotting its eigenvalues and eigenvectors.</span>

<span class="sd">    :param rotate_angle: Angle to rotate the covariance ellipse (default: pi/4).</span>
<span class="sd">    :param lambda1: First eigenvalue (default: 0.5).</span>
<span class="sd">    :param lambda2: Second eigenvalue (default: 0.3).</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams/gp&#39;).</span>
<span class="sd">    :param fill_color: Fill color for the ellipse (default: yellow).</span>
<span class="sd">    :param black_color: Color for axes and lines (default: black).</span>
<span class="sd">    :param blue_color: Color for one eigenvector (default: blue).</span>
<span class="sd">    :param magenta_color: Color for the other eigenvector (default: magenta).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">big_figsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

    <span class="n">cax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>

    <span class="c1"># Matrix label axes</span>
    <span class="n">tax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">tax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
    <span class="n">tax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
    <span class="n">tax2</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">label_eigenvalue</span> <span class="o">=</span> <span class="n">tax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Lambda=$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Polygon</span>
    <span class="n">pat_hand</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lambda1</span><span class="p">,</span> <span class="n">lambda1</span><span class="p">],</span> 
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])),</span> 
                        <span class="n">facecolor</span><span class="o">=</span><span class="n">fill_color</span><span class="p">,</span> 
                        <span class="n">edgecolor</span><span class="o">=</span><span class="n">black_color</span><span class="p">,</span> 
                        <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pat_hand</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotate_angle</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotate_angle</span><span class="p">)],</span> 
                                  <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotate_angle</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotate_angle</span><span class="p">)]])</span>
    <span class="n">new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotation_matrix</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">pat_hand</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lambda1</span><span class="p">,</span> <span class="n">lambda1</span><span class="p">],</span> 
                                                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])),</span> 
                        <span class="n">facecolor</span><span class="o">=</span><span class="n">fill_color</span><span class="p">,</span> 
                        <span class="n">edgecolor</span><span class="o">=</span><span class="n">black_color</span><span class="p">,</span> 
                        <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="n">pat_hand_rot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> 
                           <span class="n">facecolor</span><span class="o">=</span><span class="n">fill_color</span><span class="p">,</span> 
                           <span class="n">edgecolor</span><span class="o">=</span><span class="n">black_color</span><span class="p">))</span>
    <span class="n">pat_hand_rot</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># 3D box</span>
    <span class="n">pat_hand3</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">lambda1</span><span class="p">,</span> <span class="mf">0.8</span><span class="o">*</span><span class="n">lambda1</span><span class="p">,</span> <span class="n">lambda1</span><span class="p">],</span> 
                                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">lambda2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">lambda2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])),</span> 
                         <span class="n">facecolor</span><span class="o">=</span><span class="n">fill_color</span><span class="p">,</span> 
                         <span class="n">edgecolor</span><span class="o">=</span><span class="n">black_color</span><span class="p">))]</span>

    <span class="n">pat_hand3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">lambda1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">lambda1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                                              <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">lambda2</span><span class="p">,</span> <span class="mf">0.8</span><span class="o">*</span><span class="n">lambda2</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">])),</span> 
                             <span class="n">facecolor</span><span class="o">=</span><span class="n">fill_color</span><span class="p">,</span> 
                             <span class="n">edgecolor</span><span class="o">=</span><span class="n">black_color</span><span class="p">)))</span>

    <span class="n">pat_hand3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(([</span><span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">lambda1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lambda1</span><span class="p">,</span> <span class="mf">0.8</span><span class="o">*</span><span class="n">lambda1</span><span class="p">],</span> 
                                              <span class="p">[</span><span class="mf">0.8</span><span class="o">*</span><span class="n">lambda2</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="mf">0.8</span><span class="o">*</span><span class="n">lambda2</span><span class="p">])),</span> 
                             <span class="n">facecolor</span><span class="o">=</span><span class="n">fill_color</span><span class="p">,</span>
                             <span class="n">edgecolor</span><span class="o">=</span><span class="n">black_color</span><span class="p">)))</span>
    <span class="n">pat_hand3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(([</span><span class="n">lambda1</span><span class="p">,</span> <span class="mf">0.8</span><span class="o">*</span><span class="n">lambda1</span><span class="p">,</span> <span class="mf">0.8</span><span class="o">*</span><span class="n">lambda1</span><span class="p">,</span> <span class="n">lambda1</span><span class="p">],</span> 
                                              <span class="p">[</span><span class="n">lambda2</span><span class="p">,</span> <span class="mf">0.8</span><span class="o">*</span><span class="n">lambda2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">lambda2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])),</span> 
                             <span class="n">facecolor</span><span class="o">=</span><span class="n">fill_color</span><span class="p">,</span> 
                             <span class="n">edgecolor</span><span class="o">=</span><span class="n">black_color</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">pat_hand3</span><span class="p">:</span>
        <span class="n">hand</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">xspan</span> <span class="o">=</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yspan</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ar_one</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">lambda1</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
    <span class="n">ar_two</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="n">lambda2</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
    <span class="n">ar_three</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dx</span><span class="o">=-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">lambda1</span><span class="p">,</span> <span class="n">dy</span><span class="o">=-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">lambda2</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
    <span class="n">ar_one_text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">lambda1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="n">yspan</span><span class="p">,</span> 
                          <span class="sa">r</span><span class="s1">&#39;$\lambda_1$&#39;</span><span class="p">,</span> 
                          <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ar_two_text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="n">xspan</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">lambda2</span><span class="p">,</span> 
                          <span class="sa">r</span><span class="s1">&#39;$\lambda_2$&#39;</span><span class="p">,</span> 
                          <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ar_three_text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="n">xspan</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">lambda1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">lambda2</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">yspan</span><span class="p">,</span> 
                            <span class="sa">r</span><span class="s1">&#39;$\lambda_3$&#39;</span><span class="p">,</span> 
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                           <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="n">ar_one</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
               <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
               <span class="n">color</span><span class="o">=</span><span class="n">blue_color</span><span class="p">)</span>
    <span class="n">ar_one_text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ar_two</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
               <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
               <span class="n">color</span><span class="o">=</span><span class="n">blue_color</span><span class="p">)</span>
    <span class="n">ar_two_text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ar_three</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
                 <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                 <span class="n">color</span><span class="o">=</span><span class="n">blue_color</span><span class="p">)</span>
    <span class="n">ar_three_text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


    <span class="n">matrix_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
    <span class="n">matrix_ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">matrix_ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">eigenvals</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">r</span><span class="s1">&#39;$\lambda_1$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0$&#39;</span><span class="p">],[</span><span class="s1">&#39;$0$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\lambda_2$&#39;</span><span class="p">]]</span>
    <span class="n">matrix</span><span class="p">(</span><span class="n">eigenvals</span><span class="p">,</span> 
           <span class="n">matrix_ax</span><span class="p">,</span> 
           <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> 
           <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span> 
           <span class="n">bracket_color</span><span class="o">=</span><span class="n">black_color</span><span class="p">)</span>


    <span class="c1"># First arrow</span>
    <span class="n">matrix_ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">matrix</span><span class="p">(</span><span class="n">eigenvals</span><span class="p">,</span> 
           <span class="n">matrix_ax</span><span class="p">,</span> 
           <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> 
           <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
           <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">highlight_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
           <span class="n">highlight_col</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
           <span class="n">highlight_color</span><span class="o">=</span><span class="n">magenta_color</span><span class="p">,</span>
           <span class="n">bracket_color</span><span class="o">=</span><span class="n">black_color</span><span class="p">)</span>

    <span class="n">ar_one</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ar_one_text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;gp-optimise-determinant</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Second arrow</span>
    <span class="n">matrix_ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">matrix</span><span class="p">(</span><span class="n">eigenvals</span><span class="p">,</span> 
           <span class="n">matrix_ax</span><span class="p">,</span> 
           <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> 
           <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span> 
           <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">highlight_row</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
           <span class="n">highlight_col</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
           <span class="n">highlight_color</span><span class="o">=</span><span class="n">magenta_color</span><span class="p">,</span>
           <span class="n">bracket_color</span><span class="o">=</span><span class="n">black_color</span><span class="p">)</span>

    <span class="n">ar_two</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ar_two_text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;gp-optimise-determinant</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">matrix_ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">matrix</span><span class="p">(</span><span class="n">eigenvals</span><span class="p">,</span> <span class="n">matrix_ax</span><span class="p">,</span> 
           <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> 
           <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span> 
           <span class="n">bracket_color</span><span class="o">=</span><span class="n">black_color</span><span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;gp-optimise-determinant</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>


    <span class="n">tax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">tax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">tax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">tax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">det_text</span> <span class="o">=</span> <span class="n">tax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>
                    <span class="sa">r</span><span class="s1">&#39;$\det{\Lambda} = \lambda_1 \lambda_2$&#39;</span><span class="p">,</span> 
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                       <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;gp-optimise-determinant</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">pat_hand</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;gp-optimise-determinant</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">det_text_plot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">lambda1</span><span class="p">,</span> 
                                  <span class="mf">0.5</span><span class="o">*</span><span class="n">lambda2</span><span class="p">,</span> 
                                  <span class="sa">r</span><span class="s1">&#39;$\det{\Lambda}$&#39;</span><span class="p">,</span> 
                                  <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;gp-optimise-determinant</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>


    <span class="n">eigenvals2</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">r</span><span class="s1">&#39;$\lambda_1$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0$&#39;</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;$0$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\lambda_2$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0$&#39;</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;$0$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\lambda_3$&#39;</span><span class="p">]]</span>

    <span class="n">matrix_ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">matrix</span><span class="p">(</span><span class="n">eigenvals2</span><span class="p">,</span> <span class="n">matrix_ax</span><span class="p">,</span> 
           <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> 
           <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
           <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">highlight_row</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
           <span class="n">highlight_col</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
           <span class="n">highlight_color</span><span class="o">=</span><span class="n">magenta_color</span><span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;gp-optimise-determinant</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>


    <span class="n">ar_three</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ar_three_text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">pat_hand3</span><span class="p">:</span>
        <span class="n">hand</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">det_text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\det{\Lambda} = \lambda_1 \lambda_2 \lambda_3$&#39;</span><span class="p">,</span> 
                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> 
                 <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;gp-optimise-determinant</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">matrix_ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">matrix</span><span class="p">(</span><span class="n">eigenvals</span><span class="p">,</span> 
           <span class="n">matrix_ax</span><span class="p">,</span> 
           <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> 
           <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span> 
           <span class="n">bracket_color</span><span class="o">=</span><span class="n">black_color</span><span class="p">)</span>

    <span class="n">ar_three</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ar_three_text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">pat_hand3</span><span class="p">:</span>
        <span class="n">hand</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">det_text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\det{\Lambda} = \lambda_1 \lambda_2$&#39;</span><span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;gp-optimise-determinant</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">det_text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\det{\mathbf</span><span class="si">{R}</span><span class="s1">\Lambda} = \lambda_1 \lambda_2$&#39;</span><span class="p">)</span>
    <span class="n">label_eigenvalue</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\Large $\mathbf</span><span class="si">{R}</span><span class="s1">\Lambda=$&#39;</span><span class="p">)</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.transforms</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mtransforms</span>

    <span class="n">det_text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\det{\mathbf</span><span class="si">{R}</span><span class="s1">\Lambda} = \lambda_1 \lambda_2$&#39;</span><span class="p">)</span>
    <span class="n">label_eigenvalue</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{R}</span><span class="s1">\Lambda=$&#39;</span><span class="p">)</span>

    <span class="n">trans_data</span> <span class="o">=</span>  <span class="n">mtransforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">rotate_deg</span><span class="p">(</span><span class="n">rotate_angle</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span>

    <span class="n">ar_one</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">trans_data</span><span class="p">)</span>
    <span class="n">ar_one_text</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">trans_data</span><span class="p">)</span>
    <span class="n">ar_two</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">trans_data</span><span class="p">)</span>
    <span class="n">ar_two_text</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">trans_data</span><span class="p">)</span>
    <span class="n">det_text_plot</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">trans_data</span><span class="p">)</span>
    <span class="n">pat_hand_rot</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pat_hand</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">pat_hand_rot</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pat_hand</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">W</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;$w_{1, 1}$&#39;</span><span class="p">,</span> <span class="s1">&#39;$w_{1, 2}$&#39;</span><span class="p">],[</span> <span class="s1">&#39;$w_{2, 1}$&#39;</span><span class="p">,</span> <span class="s1">&#39;$w_{2, 2}$&#39;</span><span class="p">]]</span>
    <span class="n">matrix</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> 
           <span class="n">matrix_ax</span><span class="p">,</span> 
           <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> 
           <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span> 
           <span class="n">bracket_color</span><span class="o">=</span><span class="n">black_color</span><span class="p">)</span>


    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;gp-optimise-determinant</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span></div>


<div class="viewcode-block" id="prob_diagram">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.prob_diagram">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">prob_diagram</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a diagram demonstrating marginal and joint probabilities.</span>

<span class="sd">    :param fontsize: Font size to use in the plot (default: 20).</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">marg</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="c1"># Distance between lines and boxes</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># indent of n indicators</span>
    <span class="n">axis_indent</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># Axis indent.</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mf">2.5</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">big_figsize</span><span class="p">)</span>

    <span class="c1"># Basic plot set up.    </span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">,</span> <span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">])</span>
    <span class="c1">#ax.set_visible(False)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="n">axis_indent</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">axis_indent</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Box for y=4</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">marg</span><span class="p">,</span> <span class="mi">6</span><span class="o">+</span><span class="n">marg</span><span class="p">,</span> <span class="mi">6</span><span class="o">+</span><span class="n">marg</span><span class="p">,</span> <span class="o">-</span><span class="n">marg</span><span class="p">,</span> <span class="o">-</span><span class="n">marg</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="n">marg</span><span class="p">,</span> <span class="mi">3</span><span class="o">-</span><span class="n">marg</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">marg</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">marg</span><span class="p">,</span> <span class="mi">3</span><span class="o">-</span><span class="n">marg</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">4</span><span class="o">-</span><span class="n">indent</span><span class="p">,</span> <span class="s1">&#39;$n_{Y=4}$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Box for x=5</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">4</span><span class="o">-</span><span class="n">marg</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="n">marg</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="n">marg</span><span class="p">,</span> <span class="mi">4</span><span class="o">-</span><span class="n">marg</span><span class="p">,</span> <span class="mi">4</span><span class="o">-</span><span class="n">marg</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">marg</span><span class="p">,</span> <span class="o">-</span><span class="n">marg</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">marg</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">marg</span><span class="p">,</span> <span class="o">-</span><span class="n">marg</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mi">4</span><span class="o">-</span><span class="n">indent</span><span class="p">,</span> <span class="s1">&#39;$n_{X=5}$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Box for x=3, y=4</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">,</span> <span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">,</span> <span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">,</span> <span class="mi">3</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">,</span> <span class="mi">3</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">marg</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">4</span><span class="o">-</span><span class="n">indent</span><span class="p">,</span> <span class="s1">&#39;$n_{X=3, Y=4}$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>


    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;$N$ crosses total&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">axis_indent</span><span class="p">,</span> <span class="s1">&#39;$X$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">axis_indent</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;$Y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;prob_diagram.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="bernoulli_urn">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.bernoulli_urn">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bernoulli_urn</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the urn of Jacob Bernoulli&#39;s analogy for the Bernoulli distribution.</span>

<span class="sd">    :param ax: Matplotlib axis to draw the plot on.</span>
<span class="sd">    :param diagrams: Directory to save the diagram (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">black_prob</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">ball_radius</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">ball_radius</span><span class="p">)</span>
    <span class="n">last_row_cols</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="n">rows</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
          <span class="n">cols</span> <span class="o">=</span> <span class="n">last_row_cols</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="n">ball_x</span> <span class="o">=</span> <span class="n">col</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">ball_radius</span> <span class="o">+</span> <span class="n">ball_radius</span>
            <span class="n">ball_y</span> <span class="o">=</span> <span class="n">row</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">ball_radius</span> <span class="o">+</span> <span class="n">ball_radius</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">ball_x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">ball_radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">ball_y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">ball_radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">&lt;</span><span class="n">black_prob</span><span class="p">:</span>
                <span class="n">ball_color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">ball_color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">ball_x</span><span class="p">,</span> <span class="n">ball_y</span><span class="p">),</span> <span class="n">ball_radius</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">ball_color</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>

    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;bernoulli-urn.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="bayes_billiard">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.bayes_billiard">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bayes_billiard</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a series of figures representing Thomas Bayes&#39; billiard table for the Bernoulli distribution representation.</span>
<span class="sd">    </span>
<span class="sd">    :param ax: Matplotlib axis to draw the plot on.</span>
<span class="sd">    :param diagrams: Directory to save the diagrams (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">black_prob</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">ball_radius</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;bayes-billiard000.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ball_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ball_y</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">black_color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">red_color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="c1">#r = 0.1</span>
    <span class="c1">#t = np.linspace(0, 2*np.pi, 24)</span>

    <span class="c1">#x = ball_x*np.ones(t.shape) + ball_radius*np.sin(t)</span>
    <span class="c1">#y = ball_y*np.ones(t.shape) + ball_radius*np.cos(t)</span>

    <span class="n">circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">ball_x</span><span class="p">,</span> <span class="n">ball_y</span><span class="p">),</span> <span class="n">ball_radius</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">black_color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>

    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;bayes-billiard001.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ball_x</span><span class="p">,</span> <span class="n">ball_x</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">black_color</span><span class="p">)</span>

    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;bayes-billiard002.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">for</span> <span class="n">ball_x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">ball_x</span><span class="p">,</span> <span class="n">ball_y</span><span class="p">),</span> <span class="n">ball_radius</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">red_color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;bayes-billiard</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">),</span>
                          <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                          <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">circle</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span></div>


            
<div class="viewcode-block" id="hyperplane_coordinates">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.hyperplane_coordinates">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">hyperplane_coordinates</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">plot_limits</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function for plotting the decision boundary of the perceptron.</span>

<span class="sd">    :param w: The weight vector for the perceptron.</span>
<span class="sd">    :param b: The bias parameter for the perceptron.</span>
<span class="sd">    :param plot_limits: Dictionary containing &#39;x&#39; and &#39;y&#39; plot limits.</span>
<span class="sd">    :returns: Tuple of (x0, x1) coordinates for the hyperplane line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="nb">abs</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="c1"># If w[1]&gt;w[0] in absolute value, plane is likely to be leaving tops of plot.</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">plot_limits</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">x0</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># otherwise plane is likely to be leaving sides of plot.</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">plot_limits</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">x1</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span></div>


<div class="viewcode-block" id="init_perceptron_plot">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.init_perceptron_plot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">init_perceptron_plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x_plus</span><span class="p">,</span> <span class="n">x_minus</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize a plot for showing the perceptron decision boundary.</span>

<span class="sd">    :param f: Matplotlib figure object.</span>
<span class="sd">    :param ax: Array of matplotlib axes (should have 2 axes).</span>
<span class="sd">    :param x_plus: Positive class data points (numpy array).</span>
<span class="sd">    :param x_minus: Negative class data points (numpy array).</span>
<span class="sd">    :param w: Weight vector for the perceptron.</span>
<span class="sd">    :param b: Bias parameter for the perceptron.</span>
<span class="sd">    :param fontsize: Font size for labels and titles (default: 18).</span>
<span class="sd">    :returns: Dictionary containing plot handles for updating.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="c1"># Plot the data again</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plus</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_plus</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;rx&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_minus</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_minus</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;go&#39;</span><span class="p">)</span>
    <span class="n">plot_limits</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">plot_limits</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())</span>
    <span class="n">plot_limits</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">hyperplane_coordinates</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">plot_limits</span><span class="p">)</span>
    <span class="n">strt</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">offset0</span> <span class="o">=</span> <span class="o">-</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">norm</span><span class="o">*</span><span class="n">b</span>
    <span class="n">offset1</span> <span class="o">=</span> <span class="o">-</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">norm</span><span class="o">*</span><span class="n">b</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;arrow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">offset0</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset0</span><span class="o">+</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">offset1</span><span class="o">+</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="c1"># plot a line to represent the separating &#39;hyperplane&#39;</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;plane&#39;</span><span class="p">],</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">plot_limits</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">plot_limits</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x_0$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;iter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Update 0&#39;</span><span class="p">)</span>
    
    <span class="n">bins</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">f_minus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_minus</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">f_plus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_plus</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">f_plus</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;+1&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">f_minus</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">h</span></div>


<div class="viewcode-block" id="update_perceptron_plot">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.update_perceptron_plot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_perceptron_plot</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x_plus</span><span class="p">,</span> <span class="n">x_minus</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update plots after decision boundary has changed.</span>

<span class="sd">    :param h: Dictionary containing plot handles from init_perceptron.</span>
<span class="sd">    :param f: Matplotlib figure object.</span>
<span class="sd">    :param ax: Array of matplotlib axes.</span>
<span class="sd">    :param x_plus: Positive class data points.</span>
<span class="sd">    :param x_minus: Negative class data points.</span>
<span class="sd">    :param i: Current iteration number.</span>
<span class="sd">    :param w: Updated weight vector.</span>
<span class="sd">    :param b: Updated bias parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Re-plot the hyper plane </span>
    <span class="n">plot_limits</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">plot_limits</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())</span>
    <span class="n">plot_limits</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">hyperplane_coordinates</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">plot_limits</span><span class="p">)</span>

    <span class="c1"># Add arrow to represent hyperplane.</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;arrow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
    <span class="k">del</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;arrow&#39;</span><span class="p">])</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">offset0</span> <span class="o">=</span> <span class="o">-</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">norm</span><span class="o">*</span><span class="n">b</span>
    <span class="n">offset1</span> <span class="o">=</span> <span class="o">-</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">norm</span><span class="o">*</span><span class="n">b</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;arrow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">offset0</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset0</span><span class="o">+</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                             <span class="n">offset1</span><span class="o">+</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;plane&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;plane&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>

    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;iter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;Update &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">f_minus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_minus</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">f_plus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_plus</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">f_plus</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;+1&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">f_minus</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

    <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">h</span></div>


<div class="viewcode-block" id="contour_error">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.contour_error">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">contour_error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m_center</span><span class="p">,</span> <span class="n">c_center</span><span class="p">,</span> <span class="n">samps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">6.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate error contour data for regression visualization.</span>

<span class="sd">    :param x: Input data points.</span>
<span class="sd">    :param y: Target values.</span>
<span class="sd">    :param m_center: Center value for slope parameter.</span>
<span class="sd">    :param c_center: Center value for intercept parameter.</span>
<span class="sd">    :param samps: Number of samples for contour generation (default: 100).</span>
<span class="sd">    :param width: Width of the parameter range (default: 6.0).</span>
<span class="sd">    :returns: Tuple of (m_vals, c_vals, E_grid) for contour plotting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create an array of linearly separated values around m_true</span>
    <span class="n">m_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">m_center</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">m_center</span><span class="o">+</span><span class="n">width</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">samps</span><span class="p">)</span> 
    <span class="c1"># create an array of linearly separated values ae</span>
    <span class="n">c_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">c_center</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">c_center</span><span class="o">+</span><span class="n">width</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">samps</span><span class="p">)</span> 
    <span class="n">m_grid</span><span class="p">,</span> <span class="n">c_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">)</span>
    <span class="n">E_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">samps</span><span class="p">,</span> <span class="n">samps</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samps</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samps</span><span class="p">):</span>
            <span class="n">E_grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">m_grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">c_grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">,</span> <span class="n">E_grid</span></div>

    
<div class="viewcode-block" id="regression_contour">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.regression_contour">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">regression_contour</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">,</span> <span class="n">E_grid</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot regression error contours.</span>

<span class="sd">    :param f: Matplotlib figure object.</span>
<span class="sd">    :param ax: Matplotlib axis object.</span>
<span class="sd">    :param m_vals: Slope parameter values.</span>
<span class="sd">    :param c_vals: Intercept parameter values.</span>
<span class="sd">    :param E_grid: Error values grid.</span>
<span class="sd">    :param fontsize: Font size for labels (default: 30).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hcont</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">,</span> <span class="n">E_grid</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">])</span> <span class="c1"># this makes the contour plot </span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">hcont</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># this labels the contours.</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$m$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$c$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span></div>


<div class="viewcode-block" id="init_regression">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.init_regression">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">init_regression</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">,</span> <span class="n">E_grid</span><span class="p">,</span> <span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize regression visualization plots.</span>

<span class="sd">    :param f: Matplotlib figure object.</span>
<span class="sd">    :param ax: Array of matplotlib axes.</span>
<span class="sd">    :param x: Input data points.</span>
<span class="sd">    :param y: Target values.</span>
<span class="sd">    :param m_vals: Slope parameter values.</span>
<span class="sd">    :param c_vals: Intercept parameter values.</span>
<span class="sd">    :param E_grid: Error values grid.</span>
<span class="sd">    :param m_star: Optimal slope value.</span>
<span class="sd">    :param c_star: Optimal intercept value.</span>
<span class="sd">    :param fontsize: Font size for labels (default: 20).</span>
<span class="sd">    :returns: Dictionary containing plot handles for updating.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">]</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;cont&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">,</span> <span class="n">E_grid</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span> <span class="c1"># this makes the contour plot on axes 0.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;cont&#39;</span><span class="p">],</span> <span class="n">inline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$m$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$c$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Error Function&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Set up plot</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Best Fit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Plot the current estimate of the best fit line</span>
    <span class="n">x_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())</span> <span class="c1"># get the x limits of the plot for plotting the current best line fit.</span>
    <span class="n">y_plot</span> <span class="o">=</span> <span class="n">m_star</span><span class="o">*</span><span class="n">x_plot</span> <span class="o">+</span> <span class="n">c_star</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;fit&#39;</span><span class="p">],</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span> <span class="n">y_plot</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    
    <span class="c1"># Set y-axis limits appropriately based on data and fit line</span>
    <span class="n">y_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_plot</span><span class="p">))</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_plot</span><span class="p">))</span>
    <span class="n">y_margin</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>  <span class="c1"># 10% margin</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="n">y_min</span> <span class="o">-</span> <span class="n">y_margin</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">+</span> <span class="n">y_margin</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">h</span></div>


<div class="viewcode-block" id="update_regression">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.update_regression">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_regression</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">,</span> <span class="n">iteration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update regression plots during optimization.</span>

<span class="sd">    :param h: Dictionary containing plot handles from init_regression.</span>
<span class="sd">    :param f: Matplotlib figure object.</span>
<span class="sd">    :param ax: Array of matplotlib axes.</span>
<span class="sd">    :param m_star: Current optimal slope value.</span>
<span class="sd">    :param c_star: Current optimal intercept value.</span>
<span class="sd">    :param iteration: Current iteration number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">,</span> <span class="s1">&#39;g*&#39;</span><span class="p">)</span>
    <span class="n">x_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())</span> <span class="c1"># get the x limits of the plot for plo</span>
    <span class="n">y_plot</span> <span class="o">=</span> <span class="n">m_star</span><span class="o">*</span><span class="n">x_plot</span> <span class="o">+</span> <span class="n">c_star</span>
    
    <span class="c1"># show the current status on the plot of the data</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">y_plot</span><span class="p">)</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;Iteration &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iteration</span><span class="p">))</span>
    <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">h</span></div>


<div class="viewcode-block" id="update_regression_path">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.update_regression_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_regression_path</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">,</span> <span class="n">iteration_text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update regression plots during optimization with custom iteration text.</span>

<span class="sd">    :param h: Dictionary containing plot handles from init_regression.</span>
<span class="sd">    :param f: Matplotlib figure object.</span>
<span class="sd">    :param ax: Array of matplotlib axes.</span>
<span class="sd">    :param m_star: Current optimal slope value.</span>
<span class="sd">    :param c_star: Current optimal intercept value.</span>
<span class="sd">    :param iteration_text: Text to display for current iteration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())</span> <span class="c1"># get the x limits of the plot for plotting the current best line fit.</span>
    <span class="n">y_plot</span> <span class="o">=</span> <span class="n">m_star</span><span class="o">*</span><span class="n">x_plot</span> <span class="o">+</span> <span class="n">c_star</span>
    
    <span class="c1"># show the current status on the plot of the data</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">y_plot</span><span class="p">)</span>
    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">iteration_text</span><span class="p">)</span>
    <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">h</span></div>


<div class="viewcode-block" id="regression_contour_fit">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.regression_contour_fit">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">regression_contour_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">learn_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">m_center</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">c_center</span><span class="o">=-</span><span class="mf">3.1</span><span class="p">,</span> <span class="n">m_star</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">c_star</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">max_iters</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot an evolving contour plot of regression optimisation.</span>

<span class="sd">    :param x: Input data points.</span>
<span class="sd">    :param y: Target values.</span>
<span class="sd">    :param learn_rate: Learning rate for optimization (default: 0.01).</span>
<span class="sd">    :param m_center: Center value for slope parameter (default: 1.4).</span>
<span class="sd">    :param c_center: Center value for intercept parameter (default: -3.1).</span>
<span class="sd">    :param m_star: Initial slope value (default: 0.0).</span>
<span class="sd">    :param c_star: Initial intercept value (default: -5.0).</span>
<span class="sd">    :param max_iters: Maximum number of iterations (default: 1000).</span>
<span class="sd">    :param diagrams: Directory to save the plots (default: &#39;../diagrams&#39;).</span>
<span class="sd">    :returns: Number of frames generated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">,</span> <span class="n">E_grid</span> <span class="o">=</span> <span class="n">contour_error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m_center</span><span class="p">,</span> <span class="n">c_center</span><span class="p">,</span> <span class="n">samps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span> <span class="c1"># this is to create &#39;side by side axes&#39;</span>
    <span class="c1"># first let&#39;s plot the error surface</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">init_regression</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">,</span> <span class="n">E_grid</span><span class="p">,</span> <span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;regression_contour_fit000.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iters</span><span class="p">):</span> <span class="c1"># do max_iters iterations</span>
        <span class="c1"># compute the gradients</span>
        <span class="n">c_grad</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">m_star</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">c_star</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">m_grad</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">m_star</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">c_star</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># update the parameters</span>
        <span class="n">m_star</span> <span class="o">=</span> <span class="n">m_star</span> <span class="o">-</span> <span class="n">learn_rate</span><span class="o">*</span><span class="n">m_grad</span>
        <span class="n">c_star</span> <span class="o">=</span> <span class="n">c_star</span> <span class="o">-</span> <span class="n">learn_rate</span><span class="o">*</span><span class="n">c_grad</span>
        <span class="c1"># update the location of our current best guess on the contour plot</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span> <span class="ow">or</span> <span class="p">((</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">1000</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)):</span> 
            <span class="n">handle</span> <span class="o">=</span> <span class="n">update_regression</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;regression_contour_fit</span><span class="si">{count:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">),</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>        
    <span class="k">return</span> <span class="n">count</span></div>


<div class="viewcode-block" id="regression_contour_sgd">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.regression_contour_sgd">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">regression_contour_sgd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">learn_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">m_center</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">c_center</span><span class="o">=-</span><span class="mf">3.1</span><span class="p">,</span> <span class="n">m_star</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">c_star</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">max_iters</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot evolution of the solution of linear regression via SGD.</span>

<span class="sd">    :param x: Input data points.</span>
<span class="sd">    :param y: Target values.</span>
<span class="sd">    :param learn_rate: Learning rate for SGD (default: 0.01).</span>
<span class="sd">    :param m_center: Center value for slope parameter (default: 1.4).</span>
<span class="sd">    :param c_center: Center value for intercept parameter (default: -3.1).</span>
<span class="sd">    :param m_star: Initial slope value (default: 0.0).</span>
<span class="sd">    :param c_star: Initial intercept value (default: -5.0).</span>
<span class="sd">    :param max_iters: Maximum number of iterations (default: 4000).</span>
<span class="sd">    :param diagrams: Directory to save the plots (default: &#39;../diagrams&#39;).</span>
<span class="sd">    :returns: Number of frames generated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">,</span> <span class="n">E_grid</span> <span class="o">=</span> <span class="n">contour_error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m_center</span><span class="p">,</span> <span class="n">c_center</span><span class="p">,</span> <span class="n">samps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span> <span class="c1"># this is to create &#39;side by side axes&#39;</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">init_regression</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">,</span> <span class="n">E_grid</span><span class="p">,</span> <span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">)</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;regression_sgd_contour_fit</span><span class="si">{count:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">),</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iters</span><span class="p">):</span> <span class="c1"># do max_iters iterations (parameter updates)</span>
        <span class="c1"># choose a random point</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># update m</span>
        <span class="n">m_star</span> <span class="o">=</span> <span class="n">m_star</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">learn_rate</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">-</span><span class="n">m_star</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">c_star</span><span class="p">))</span>
        <span class="c1"># update c</span>
        <span class="n">c_star</span> <span class="o">=</span> <span class="n">c_star</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">learn_rate</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">-</span><span class="n">m_star</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">c_star</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span> <span class="ow">or</span> <span class="p">((</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)):</span> 
            <span class="n">handle</span> <span class="o">=</span> <span class="n">update_regression</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;regression_sgd_contour_fit</span><span class="si">{count:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">),</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count</span></div>


<div class="viewcode-block" id="regression_contour_coordinate_descent">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.regression_contour_coordinate_descent">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">regression_contour_coordinate_descent</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m_center</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">c_center</span><span class="o">=-</span><span class="mf">3.1</span><span class="p">,</span> <span class="n">m_star</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">c_star</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">max_iters</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot evolution of the solution of linear regression via coordinate descent.</span>

<span class="sd">    :param x: Input data points.</span>
<span class="sd">    :param y: Target values.</span>
<span class="sd">    :param m_center: Center value for slope parameter (default: 1.4).</span>
<span class="sd">    :param c_center: Center value for intercept parameter (default: -3.1).</span>
<span class="sd">    :param m_star: Initial slope value (default: 0.0).</span>
<span class="sd">    :param c_star: Initial intercept value (default: -5.0).</span>
<span class="sd">    :param max_iters: Maximum number of iterations (default: 100).</span>
<span class="sd">    :param diagrams: Directory to save the plots (default: &#39;../diagrams&#39;).</span>
<span class="sd">    :returns: Number of frames generated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">,</span> <span class="n">E_grid</span> <span class="o">=</span> <span class="n">contour_error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m_center</span><span class="p">,</span> <span class="n">c_center</span><span class="p">,</span> <span class="n">samps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span> <span class="c1"># this is to create &#39;side by side axes&#39;</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">init_regression</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m_vals</span><span class="p">,</span> <span class="n">c_vals</span><span class="p">,</span> <span class="n">E_grid</span><span class="p">,</span> <span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">)</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;regression_coordinate_descent_contour_fit</span><span class="si">{count:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">),</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    
    <span class="c1"># Store path for staircase visualization</span>
    <span class="n">path_points</span> <span class="o">=</span> <span class="p">[(</span><span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">)]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iters</span><span class="p">):</span> <span class="c1"># do max_iters iterations (parameter updates)</span>
        <span class="c1"># Store previous values for path drawing</span>
        <span class="n">prev_m</span><span class="p">,</span> <span class="n">prev_c</span> <span class="o">=</span> <span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span>
        
        <span class="c1"># Update m: m = ((y - c)*x).sum()/(x*x).sum()</span>
        <span class="n">m_star</span> <span class="o">=</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">c_star</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        
        <span class="c1"># Plot after m update (horizontal step)</span>
        <span class="n">path_points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">path_x</span><span class="p">,</span> <span class="n">path_y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">path_points</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">path_x</span><span class="p">,</span> <span class="n">path_y</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">,</span> <span class="s1">&#39;g*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        
        <span class="c1"># Update the fit line and save frame</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">update_regression_path</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;m update, iter </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;regression_coordinate_descent_contour_fit</span><span class="si">{count:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">),</span>
                          <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
        
        <span class="c1"># Update c: c = (y-m*x).sum()/y.shape[0]</span>
        <span class="n">c_star</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">m_star</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Plot after c update (vertical step)</span>
        <span class="n">path_points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">path_x</span><span class="p">,</span> <span class="n">path_y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">path_points</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">path_x</span><span class="p">,</span> <span class="n">path_y</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">,</span> <span class="s1">&#39;g*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        
        <span class="c1"># Update the fit line and save frame</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">update_regression_path</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">m_star</span><span class="p">,</span> <span class="n">c_star</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;c update, iter </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;regression_coordinate_descent_contour_fit</span><span class="si">{count:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">),</span>
                          <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count</span></div>


<div class="viewcode-block" id="over_determined_system">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.over_determined_system">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">over_determined_system</span><span class="p">(</span><span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize what happens in an over determined system with linear regression.</span>

<span class="sd">    :param diagrams: Directory to save the plots (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">m</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">yvals</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">xvals</span><span class="o">+</span><span class="n">c</span>
    <span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">m</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">yvals</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">xvals</span><span class="o">+</span><span class="n">c</span>

    <span class="n">ylim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;$y=mx+c$&#39;</span><span class="p">,</span>  <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;over_determined_system001.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ctext</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">c</span><span class="o">+</span><span class="mf">0.15</span><span class="p">,</span> <span class="s1">&#39;$c$&#39;</span><span class="p">,</span>  <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>
    <span class="n">yl</span> <span class="o">=</span> <span class="n">xl</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="n">c</span>
    <span class="n">mhand</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xl</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">yl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">yl</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">mhand2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xl</span><span class="p">)],</span> <span class="p">[</span><span class="n">yl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yl</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">mtext</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xl</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">yl</span><span class="p">)</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;$m$&#39;</span><span class="p">,</span>  <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;over_determined_system002.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">a2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;over_determined_system003.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">xs</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">xs</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="mf">0.3</span>

    <span class="n">ast</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;over_determined_system004.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ys</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xs</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">ys</span><span class="o">-</span><span class="n">m</span><span class="o">*</span><span class="n">xs</span>
    <span class="n">yvals</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">xvals</span><span class="o">+</span><span class="n">c</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">i</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mhand</span><span class="p">:</span>
        <span class="n">i</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mhand2</span><span class="p">:</span>
        <span class="n">i</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mtext</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ctext</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ast</span><span class="p">:</span>
        <span class="n">i</span><span class="o">.</span><span class="n">set_color</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;over_determined_system005.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">ys</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">xs</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">m</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yvals</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">xvals</span><span class="o">+</span><span class="n">c</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a3</span><span class="p">:</span>
        <span class="n">i</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">a4</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ast</span><span class="p">:</span>
        <span class="n">i</span><span class="o">.</span><span class="n">set_color</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;over_determined_system006.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">i</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a3</span><span class="p">:</span>
        <span class="n">i</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;over_determined_system007.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="gaussian_of_height">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.gaussian_of_height">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gaussian_of_height</span><span class="p">(</span><span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a Gaussian density representing heights.</span>

<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="s2">&quot;Gaussian density representing heights.&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">sigma2</span> <span class="o">=</span> <span class="mf">0.0225</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="mf">1.7</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sigma2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">f2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">wide_figsize</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$h/m$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p(h|\mu, \sigma^2)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;gaussian_of_height.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="gaussian_volume_1D">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.gaussian_volume_1D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gaussian_volume_1D</span><span class="p">(</span><span class="n">r_yolk</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">r_iron_sulfide</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot Gaussian volumes in 1D with shaded regions representing different probability areas.</span>
<span class="sd">    </span>
<span class="sd">    This function creates a visualization of a 1D Gaussian distribution with three distinct</span>
<span class="sd">    shaded regions representing different probability masses:</span>
<span class="sd">    </span>
<span class="sd">    - Yolk (65.8%): Central region from -0.95 to 0.95 standard deviations</span>
<span class="sd">    - Iron Sulfide (4.8%): Intermediate regions from 0.95 to 1.05 and -1.05 to -0.95 std devs</span>
<span class="sd">    - White (29.4%): Outer regions beyond 1.05 standard deviations</span>
<span class="sd">    </span>
<span class="sd">    The visualization is inspired by the composition of an egg, where different regions</span>
<span class="sd">    represent different probability masses of the Gaussian distribution.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        None: Saves the plot as &#39;gaussian-volume-1D-shaded.svg&#39; in the specified directory</span>
<span class="sd">        </span>
<span class="sd">    Note:</span>
<span class="sd">        The function uses scipy.stats.norm for the Gaussian probability density function.</span>
<span class="sd">        The plot includes grid lines and proper axis labels for clarity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>

    <span class="c1"># 1D Gaussian</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> 
    <span class="n">y1</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Reduced linewidth for better visibility of shading</span>

    <span class="c1"># Calculate x-values for shading</span>
    <span class="c1"># Inner area (yolk) of the Gaussian from the mean outwards</span>
    <span class="c1"># This corresponds to the area between -r_yolk and r_yolk standard deviations</span>
    <span class="n">x_yolk</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[(</span><span class="n">x1</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">r_yolk</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x1</span> <span class="o">&lt;=</span> <span class="n">r_yolk</span><span class="p">)]</span>
    <span class="n">y_yolk</span> <span class="o">=</span> <span class="n">y1</span><span class="p">[(</span><span class="n">x1</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">r_yolk</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x1</span> <span class="o">&lt;=</span> <span class="n">r_yolk</span><span class="p">)]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_yolk</span><span class="p">,</span> <span class="n">y_yolk</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Yolk (65.8%)&#39;</span><span class="p">)</span> <span class="c1"># Using yellow for yolk</span>

    <span class="c1"># Next area (iron sulfide)</span>
    <span class="c1"># This corresponds to the area between r_yolk and r_iron_sulfide standard deviations on each side</span>
    <span class="n">x_iron_sulfide_right</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[(</span><span class="n">x1</span> <span class="o">&gt;</span> <span class="n">r_yolk</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x1</span> <span class="o">&lt;=</span> <span class="n">r_iron_sulfide</span><span class="p">)]</span>
    <span class="n">y_iron_sulfide_right</span> <span class="o">=</span> <span class="n">y1</span><span class="p">[(</span><span class="n">x1</span> <span class="o">&gt;</span> <span class="n">r_yolk</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x1</span> <span class="o">&lt;=</span> <span class="n">r_iron_sulfide</span><span class="p">)]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_iron_sulfide_right</span><span class="p">,</span> <span class="n">y_iron_sulfide_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Iron Sulfide (4.8%)&#39;</span><span class="p">)</span>

    <span class="n">x_iron_sulfide_left</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[(</span><span class="n">x1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">r_yolk</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x1</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">r_iron_sulfide</span><span class="p">)]</span>
    <span class="n">y_iron_sulfide_left</span> <span class="o">=</span> <span class="n">y1</span><span class="p">[(</span><span class="n">x1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">r_yolk</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x1</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">r_iron_sulfide</span><span class="p">)]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_iron_sulfide_left</span><span class="p">,</span> <span class="n">y_iron_sulfide_left</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span> <span class="c1"># No label for the second part of the same region</span>

    <span class="c1"># Outside area (white): 29.4%</span>
    <span class="c1"># This is the remaining area outside the yolk and iron sulfide regions</span>
    <span class="n">x_white_right</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">x1</span> <span class="o">&gt;</span> <span class="n">r_iron_sulfide</span><span class="p">]</span>
    <span class="n">y_white_right</span> <span class="o">=</span> <span class="n">y1</span><span class="p">[</span><span class="n">x1</span> <span class="o">&gt;</span> <span class="n">r_iron_sulfide</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_white_right</span><span class="p">,</span> <span class="n">y_white_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;White (29.4%)&#39;</span><span class="p">)</span>

    <span class="n">x_white_left</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">x1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">r_iron_sulfide</span><span class="p">]</span>
    <span class="n">y_white_left</span> <span class="o">=</span> <span class="n">y1</span><span class="p">[</span><span class="n">x1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">r_iron_sulfide</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_white_left</span><span class="p">,</span> <span class="n">y_white_left</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span> <span class="c1"># No label for the second part of the same region</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;gaussian-volume-1D.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="gaussian_volume_2D">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.gaussian_volume_2D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gaussian_volume_2D</span><span class="p">(</span><span class="n">r_yolk</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">r_iron_sulfide</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">r_outer</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot Gaussian volumes in 2D viewed from above using egg-shaped ellipses.</span>
<span class="sd">    </span>
<span class="sd">    This function creates a visualization of a 2D Gaussian distribution viewed from above with three distinct</span>
<span class="sd">    elliptical regions representing different probability masses:</span>
<span class="sd">    </span>
<span class="sd">    - Yellow: Central elliptical region with radius r_yolk standard deviations</span>
<span class="sd">    - Green: Intermediate elliptical ring from radius r_yolk to r_iron_sulfide standard deviations  </span>
<span class="sd">    - White: Outer elliptical region beyond radius r_iron_sulfide of 3 standard deviations</span>
<span class="sd">    </span>
<span class="sd">    The visualization is inspired by the composition of an egg viewed from above, where different regions</span>
<span class="sd">    represent different probability masses of the 2D Gaussian distribution. The ellipses are slightly eccentric to give them a more egg-like appearance.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        None: Saves the plot as &#39;gaussian-volume-2D.svg&#39; in the specified directory</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>

    <span class="c1"># Egg-like eccentricity: slightly wider than tall</span>
    <span class="n">width_factor</span> <span class="o">=</span> <span class="mf">1.1</span>  <span class="c1"># Make ellipses 10% wider than tall</span>
    <span class="n">height_factor</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Draw the egg ellipses with boundaries</span>
    <span class="n">_draw_egg_ellipses</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">r_yolk</span><span class="p">,</span> <span class="n">r_iron_sulfide</span><span class="p">,</span> <span class="n">r_outer</span><span class="p">,</span> <span class="n">width_factor</span><span class="p">,</span> <span class="n">height_factor</span><span class="p">,</span> <span class="n">add_boundary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    
    <span class="c1"># Set axis limits to show the full visualization</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">r_outer</span><span class="o">*</span><span class="mf">1.2</span><span class="o">*</span><span class="n">width_factor</span><span class="p">,</span> <span class="n">r_outer</span><span class="o">*</span><span class="mf">1.2</span><span class="o">*</span><span class="n">width_factor</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">r_outer</span><span class="o">*</span><span class="mf">1.2</span><span class="o">*</span><span class="n">height_factor</span><span class="p">,</span> <span class="n">r_outer</span><span class="o">*</span><span class="mf">1.2</span><span class="o">*</span><span class="n">height_factor</span><span class="p">)</span>
    
    <span class="c1"># Add legend</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Patch</span>
    <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Yolk&#39;</span><span class="p">),</span>
        <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Iron Sulfide&#39;</span><span class="p">),</span>
        <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;White&#39;</span><span class="p">)</span>
    <span class="p">]</span>
    
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;gaussian-volume-2D.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_draw_egg_ellipses</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">r_yolk</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">r_iron_sulfide</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">r_outer</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> 
                      <span class="n">width_factor</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">height_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">add_boundary</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to draw the egg-shaped ellipses for both 2D and 3D visualizations.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    ax : matplotlib axes</span>
<span class="sd">        The axes to draw on</span>
<span class="sd">    r_yolk : float</span>
<span class="sd">        Radius of the yolk (yellow) region</span>
<span class="sd">    r_iron_sulfide : float  </span>
<span class="sd">        Radius of the iron sulfide (green) region</span>
<span class="sd">    r_outer : float</span>
<span class="sd">        Radius of the outer (white) region</span>
<span class="sd">    width_factor : float</span>
<span class="sd">        Factor to make ellipses wider (egg-like)</span>
<span class="sd">    height_factor : float</span>
<span class="sd">        Factor for ellipse height</span>
<span class="sd">    add_boundary : bool</span>
<span class="sd">        Whether to add black boundary line</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ellipse</span>
    
    <span class="c1"># Draw the outer white ellipse (background)</span>
    <span class="n">outer_ellipse</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">r_outer</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">width_factor</span><span class="p">,</span> <span class="n">r_outer</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">height_factor</span><span class="p">,</span> 
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">outer_ellipse</span><span class="p">)</span>
    
    <span class="c1"># Draw the iron sulfide (green) ellipse</span>
    <span class="n">iron_ellipse</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">r_iron_sulfide</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">width_factor</span><span class="p">,</span> <span class="n">r_iron_sulfide</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">height_factor</span><span class="p">,</span> 
                          <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">iron_ellipse</span><span class="p">)</span>
    
    <span class="c1"># Draw the yolk (yellow) ellipse</span>
    <span class="n">yolk_ellipse</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">r_yolk</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">width_factor</span><span class="p">,</span> <span class="n">r_yolk</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">height_factor</span><span class="p">,</span> 
                          <span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">yolk_ellipse</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">add_boundary</span><span class="p">:</span>
        <span class="c1"># Add boundary ellipse only for the outer white region</span>
        <span class="n">ellipse_outer</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">r_outer</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">width_factor</span><span class="p">,</span> <span class="n">r_outer</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">height_factor</span><span class="p">,</span> 
                               <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse_outer</span><span class="p">)</span>


<div class="viewcode-block" id="gaussian_volume_3D">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.gaussian_volume_3D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gaussian_volume_3D</span><span class="p">(</span><span class="n">r_yolk</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">r_iron_sulfide</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">r_outer</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot Gaussian volumes in 3D viewed from above using egg-shaped ellipses with a semi-transparent</span>
<span class="sd">    white overlay to give a 3D depth effect.</span>
<span class="sd">    </span>
<span class="sd">    This function creates a visualization of a 3D Gaussian distribution viewed from above with three distinct</span>
<span class="sd">    elliptical regions representing different probability masses, plus a semi-transparent white overlay</span>
<span class="sd">    to simulate looking through the white of the egg:</span>
<span class="sd">    </span>
<span class="sd">    - Yellow: Central elliptical region with radius r_yolk standard deviations</span>
<span class="sd">    - Green: Intermediate elliptical ring from radius r_yolk to r_iron_sulfide standard deviations  </span>
<span class="sd">    - White: Outer elliptical region beyond radius r_iron_sulfide of 3 standard deviations </span>
<span class="sd">    - Semi-transparent white overlay: Gives the 3D depth effect</span>
<span class="sd">    </span>
<span class="sd">    The visualization is inspired by the composition of an egg viewed from above, where different regions</span>
<span class="sd">    represent different probability masses of the 3D Gaussian distribution. The ellipses are slightly</span>
<span class="sd">    eccentric to give them a more egg-like appearance.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        None: Saves the plot as &#39;gaussian-volume-3D.svg&#39; in the specified directory</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ellipse</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>

    <span class="c1"># Egg-like eccentricity: slightly wider than tall</span>
    <span class="n">width_factor</span> <span class="o">=</span> <span class="mf">1.1</span>  <span class="c1"># Make ellipses 10% wider than tall</span>
    <span class="n">height_factor</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Draw the egg ellipses (without boundaries for cleaner 3D look)</span>
    <span class="n">_draw_egg_ellipses</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">r_yolk</span><span class="p">,</span> <span class="n">r_iron_sulfide</span><span class="p">,</span> <span class="n">r_outer</span><span class="p">,</span> <span class="n">width_factor</span><span class="p">,</span> <span class="n">height_factor</span><span class="p">,</span> <span class="n">add_boundary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Add semi-transparent white overlay for 3D effect</span>
    <span class="n">overlay_ellipse</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">r_outer</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">width_factor</span><span class="p">,</span> <span class="n">r_outer</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">height_factor</span><span class="p">,</span> 
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">overlay_ellipse</span><span class="p">)</span>
    
    <span class="c1"># Add white border after overlay to ensure it&#39;s visible</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ellipse</span>
    <span class="n">white_border</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">r_outer</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">width_factor</span><span class="p">,</span> <span class="n">r_outer</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">height_factor</span><span class="p">,</span> 
                          <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">white_border</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    
    <span class="c1"># Set axis limits to show the full visualization</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">r_outer</span><span class="o">*</span><span class="mf">1.2</span><span class="o">*</span><span class="n">width_factor</span><span class="p">,</span> <span class="n">r_outer</span><span class="o">*</span><span class="mf">1.2</span><span class="o">*</span><span class="n">width_factor</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">r_outer</span><span class="o">*</span><span class="mf">1.2</span><span class="o">*</span><span class="n">height_factor</span><span class="p">,</span> <span class="n">r_outer</span><span class="o">*</span><span class="mf">1.2</span><span class="o">*</span><span class="n">height_factor</span><span class="p">)</span>
    
    <span class="c1"># Add legend</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Patch</span>
    <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Yolk&#39;</span><span class="p">),</span>
        <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Iron Sulfide&#39;</span><span class="p">),</span>
        <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;White&#39;</span><span class="p">)</span>
    <span class="p">]</span>
    
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;gaussian-volume-3D.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="marathon_fit">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.marathon_fit">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">marathon_fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_range</span><span class="p">,</span>
                 <span class="n">xlim</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">objective_ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;olympic&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">png_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">samps</span><span class="o">=</span><span class="mi">130</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot fit of the olympic marathon data alongside error.</span>

<span class="sd">    :param model: Model object with a predict method and data attributes.</span>
<span class="sd">    :param value: Value to fit.</span>
<span class="sd">    :param param_name: Name of the parameter being varied.</span>
<span class="sd">    :param param_range: Range of parameter values.</span>
<span class="sd">    :param xlim: Limits for the x-axis.</span>
<span class="sd">    :param fig: Matplotlib figure object.</span>
<span class="sd">    :param ax: Array of matplotlib axes.</span>
<span class="sd">    :param x_val: Optional x value for highlighting (default: None).</span>
<span class="sd">    :param y_val: Optional y value for highlighting (default: None).</span>
<span class="sd">    :param objective: Objective function (optional).</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    :param fontsize: Font size for labels (default: 20).</span>
<span class="sd">    :param objective_ylim: Y-axis limits for the objective plot (optional).</span>
<span class="sd">    :param prefix: Prefix for saved plot filenames (default: &#39;olympic&#39;).</span>
<span class="sd">    :param title: Title for the plot (optional).</span>
<span class="sd">    :param png_plot: Whether to save as PNG (default: False).</span>
<span class="sd">    :param samps: Number of samples for prediction (default: 130).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">objective_name</span>
        
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        
    <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

    <span class="n">x_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">samps</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_var</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_pred</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">y_var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">GPY_AVAILABLE</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">mlai.gp_tutorial</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpt</span>
            <span class="n">gpt</span><span class="o">.</span><span class="n">meanplot</span><span class="p">(</span><span class="n">x_pred</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pred</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">y_var</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">GPY_AVAILABLE</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">mlai.gp_tutorial</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpt</span>
            <span class="n">gpt</span><span class="o">.</span><span class="n">gpplot</span><span class="p">(</span><span class="n">x_pred</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">-</span> <span class="n">y_err</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">+</span> <span class="n">y_err</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pred</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">y_err</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">+</span> <span class="n">y_err</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
    <span class="c1">#ax[0].set_xlabel(&#39;year&#39;, fontsize=fontsize)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">objective</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#ax[1].cla()</span>
        <span class="c1">#params = range(*param_range)</span>
        <span class="c1">#for name, vals in objective.items():</span>
        <span class="c1">#    ax[1].plot(np.array(params), vals, &#39;o&#39;,</span>
        <span class="c1">#               color=[1, 0, 0], markersize=6, linewidth=3)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">objective</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_range</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">xlow</span> <span class="o">=</span> <span class="n">param_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">param_range</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">xhigh</span> <span class="o">=</span> <span class="n">param_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlow</span> <span class="o">=</span> <span class="n">param_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">xhigh</span> <span class="o">=</span> <span class="n">param_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">xlow</span><span class="p">,</span> <span class="n">xhigh</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">objective_ylim</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">param_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{prefix}</span><span class="s1">_</span><span class="si">{name}</span><span class="s1">_</span><span class="si">{param_name}{value:0&gt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">param_name</span><span class="o">=</span><span class="n">param_name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">png_plot</span><span class="p">:</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span>
                          <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                          <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>




<div class="viewcode-block" id="rmse_fit">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.rmse_fit">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rmse_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_range</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">LM</span><span class="p">,</span> <span class="c1">#plot_objectives={&#39;RMSE&#39;:ma.MapModel.rmse},</span>
             <span class="n">objective_ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">plot_fit</span><span class="o">=</span><span class="n">marathon_fit</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit a model and show RMSE error.</span>

<span class="sd">    :param x: The input x data.</span>
<span class="sd">    :param y: The input y data.</span>
<span class="sd">    :param param_name: The parameter name to vary.</span>
<span class="sd">    :param param_range: The range over which to vary the parameter.</span>
<span class="sd">    :param model: The model to fit (default is LM).</span>
<span class="sd">    :param objective_ylim: The y limits for the plot of the objective.</span>
<span class="sd">    :param xlim: The x limits for the plot.</span>
<span class="sd">    :param plot_fit: Function to use for plotting the fit.</span>
<span class="sd">    :param diagrams: Directory to save the plots (default: &#39;../diagrams&#39;).</span>
<span class="sd">    :param **kwargs: Additional keyword arguments passed to plot_fit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="n">num_data</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">params</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">param_range</span><span class="p">)</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="c1"># compute appropriate objective. </span>
        <span class="c1">#for name, plot_objective in plot_objectives.items():</span>
        <span class="n">obj</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">rmse</span><span class="p">()</span><span class="c1">#[name][count] = plot_objective(m)</span>
            
        <span class="n">plot_fit</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
                 <span class="n">param_name</span><span class="o">=</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_range</span><span class="o">=</span><span class="n">param_range</span><span class="p">,</span>
                 <span class="n">objective</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">objective_ylim</span><span class="o">=</span><span class="n">objective_ylim</span><span class="p">,</span>
                 <span class="n">fig</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span></div>



<div class="viewcode-block" id="holdout_fit">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.holdout_fit">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">holdout_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_range</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">LM</span><span class="p">,</span> <span class="n">val_start</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                <span class="n">objective_ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_fit</span><span class="o">=</span><span class="n">marathon_fit</span><span class="p">,</span>
                <span class="n">permute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;olympic_val&#39;</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit a model and show holdout error.</span>

<span class="sd">    :param x: The input x data.</span>
<span class="sd">    :param y: The input y data.</span>
<span class="sd">    :param param_name: The parameter name to vary.</span>
<span class="sd">    :param param_range: The range over which to vary the parameter.</span>
<span class="sd">    :param model: The model to fit (default is LM).</span>
<span class="sd">    :param val_start: Starting index for validation set (default: 20).</span>
<span class="sd">    :param objective_ylim: The y limits for the plot of the objective.</span>
<span class="sd">    :param xlim: The x limits for the plot.</span>
<span class="sd">    :param plot_fit: Function to use for plotting the fit.</span>
<span class="sd">    :param permute: Whether to permute the data (default: True).</span>
<span class="sd">    :param prefix: Prefix for saved plot filenames (default: &#39;olympic_val&#39;).</span>
<span class="sd">    :param diagrams: Directory to save the plots (default: &#39;../diagrams&#39;).</span>
<span class="sd">    :param **kwargs: Additional keyword arguments passed to plot_fit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="n">num_data</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">permute</span><span class="p">:</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">num_data</span><span class="p">)</span>
        <span class="n">x_tr</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">perm</span><span class="p">[:</span><span class="n">val_start</span><span class="p">],</span> <span class="p">:]</span>
        <span class="n">x_val</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">val_start</span><span class="p">:],</span> <span class="p">:]</span>
        <span class="n">y_tr</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">perm</span><span class="p">[:</span><span class="n">val_start</span><span class="p">],</span> <span class="p">:]</span>
        <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">val_start</span><span class="p">:],</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_tr</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">val_start</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x_val</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">val_start</span><span class="p">:,</span> <span class="p">:]</span>
        <span class="n">y_tr</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">val_start</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">val_start</span><span class="p">:,</span> <span class="p">:]</span>
    <span class="n">num_val_data</span> <span class="o">=</span> <span class="n">x_val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">params</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">param_range</span><span class="p">)</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
    <span class="n">ss_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>    
        <span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x_tr</span><span class="p">,</span> <span class="n">y_tr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">f_val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_val</span><span class="p">)</span>
        <span class="n">ss</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">objective</span><span class="p">()</span>
        <span class="n">ss_val</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">y_val</span><span class="o">-</span><span class="n">f_val</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> 
        <span class="n">ll</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">()</span>
        <span class="n">plot_fit</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
                 <span class="n">param_name</span><span class="o">=</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_range</span><span class="o">=</span><span class="n">param_range</span><span class="p">,</span>
                 <span class="n">objective</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ss_val</span><span class="p">[</span><span class="n">count</span><span class="p">]),</span> <span class="n">objective_ylim</span><span class="o">=</span><span class="n">objective_ylim</span><span class="p">,</span>
                 <span class="n">fig</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span>
                 <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Hold Out Validation&quot;</span><span class="p">,</span>
                 <span class="n">x_val</span><span class="o">=</span><span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span><span class="o">=</span><span class="n">y_val</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span></div>


<div class="viewcode-block" id="loo_fit">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.loo_fit">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">loo_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_range</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">LM</span><span class="p">,</span> <span class="n">objective_ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_fit</span><span class="o">=</span><span class="n">marathon_fit</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;olympic_loo&#39;</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit a model and show leave one out error.</span>

<span class="sd">    :param x: The input x data.</span>
<span class="sd">    :param y: The input y data.</span>
<span class="sd">    :param param_name: The parameter name to vary.</span>
<span class="sd">    :param param_range: The range over which to vary the parameter.</span>
<span class="sd">    :param model: The model to fit (default is LM).</span>
<span class="sd">    :param objective_ylim: The y limits for the plot of the objective.</span>
<span class="sd">    :param xlim: The x limits for the plot.</span>
<span class="sd">    :param plot_fit: Function to use for plotting the fit.</span>
<span class="sd">    :param prefix: Prefix for saved plot filenames (default: &#39;olympic_loo&#39;).</span>
<span class="sd">    :param diagrams: Directory to save the plots (default: &#39;../diagrams&#39;).</span>
<span class="sd">    :param **kwargs: Additional keyword arguments passed to plot_fit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>


    <span class="n">num_data</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">num_parts</span> <span class="o">=</span> <span class="n">num_data</span>
    <span class="n">partitions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_parts</span><span class="p">):</span>
        <span class="n">train_ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">part</span><span class="p">))</span>
        <span class="n">train_ind</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">part</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">num_data</span><span class="p">))</span>
        <span class="n">val_ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">part</span><span class="p">]</span>
        <span class="n">partitions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">val_ind</span><span class="p">))</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">param_range</span><span class="p">)</span>        
        <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
        <span class="n">ss_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">ss_temp</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">ll_temp</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">ss_val_temp</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">for</span> <span class="n">part</span><span class="p">,</span> <span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">val_ind</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">partitions</span><span class="p">):</span>
                <span class="n">x_tr</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">x_val</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">val_ind</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">y_tr</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">val_ind</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">num_val_data</span> <span class="o">=</span> <span class="n">x_val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x_tr</span><span class="p">,</span> <span class="n">y_tr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                <span class="n">ss_temp</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">objective</span><span class="p">()</span>
                <span class="n">ll_temp</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">()</span>
                <span class="n">f_val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_val</span><span class="p">)</span>
                <span class="n">ss_val_temp</span> <span class="o">+=</span> <span class="p">((</span><span class="n">y_val</span><span class="o">-</span><span class="n">f_val</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> 
                <span class="n">plot_fit</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">param_name</span><span class="o">=</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_range</span><span class="o">=</span><span class="n">param_range</span><span class="p">,</span>
                         <span class="n">objective</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">objective_ylim</span><span class="o">=</span><span class="n">objective_ylim</span><span class="p">,</span>
                         <span class="n">fig</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;olympic_loo</span><span class="si">{part:0&gt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part</span><span class="o">=</span><span class="n">part</span><span class="p">),</span>
                         <span class="n">x_val</span><span class="o">=</span><span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span><span class="o">=</span><span class="n">y_val</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
            <span class="n">ss</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss_temp</span><span class="o">/</span><span class="p">(</span><span class="n">num_parts</span><span class="p">)</span>
            <span class="n">ll</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">ll_temp</span><span class="o">/</span><span class="p">(</span><span class="n">num_parts</span><span class="p">)</span>
            <span class="n">ss_val</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss_val_temp</span><span class="o">/</span><span class="p">(</span><span class="n">num_parts</span><span class="p">)</span>
            <span class="n">plot_fit</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">param_name</span><span class="o">=</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_range</span><span class="o">=</span><span class="n">param_range</span><span class="p">,</span>
                     <span class="n">objective</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ss_val</span><span class="p">[</span><span class="n">count</span><span class="p">]),</span> <span class="n">objective_ylim</span><span class="o">=</span><span class="n">objective_ylim</span><span class="p">,</span>
                     <span class="n">fig</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;olympic_loo</span><span class="si">{part:0&gt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">partitions</span><span class="p">)),</span>
                     <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Leave One Out Validation&quot;</span><span class="p">,</span>
                     <span class="n">x_val</span><span class="o">=</span><span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span><span class="o">=</span><span class="n">y_val</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
            <span class="n">count</span><span class="o">+=</span><span class="mi">1</span></div>



<div class="viewcode-block" id="cv_fit">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.cv_fit">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cv_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_range</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">LM</span><span class="p">,</span> <span class="n">objective_ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
               <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_fit</span><span class="o">=</span><span class="n">marathon_fit</span><span class="p">,</span> <span class="n">num_parts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit a model and show cross validation error.</span>

<span class="sd">    :param x: The input x data.</span>
<span class="sd">    :param y: The input y data.</span>
<span class="sd">    :param param_name: The parameter name to vary.</span>
<span class="sd">    :param param_range: The range over which to vary the parameter.</span>
<span class="sd">    :param model: The model to fit (default is LM).</span>
<span class="sd">    :param objective_ylim: The y limits for the plot of the objective.</span>
<span class="sd">    :param xlim: The x limits for the plot.</span>
<span class="sd">    :param plot_fit: Function to use for plotting the fit.</span>
<span class="sd">    :param num_parts: Number of parts for cross-validation (default: 5).</span>
<span class="sd">    :param diagrams: Directory to save the plots (default: &#39;../diagrams&#39;).</span>
<span class="sd">    :param **kwargs: Additional keyword arguments passed to plot_fit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="n">num_data</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">partitions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">num_data</span><span class="p">))</span>
    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_parts</span><span class="p">):</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">num_data</span><span class="p">)</span><span class="o">/</span><span class="n">num_parts</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">part</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">train_ind</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span>
        <span class="n">train_ind</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="n">end</span><span class="p">:])</span>
        <span class="n">val_ind</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
        <span class="n">partitions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">val_ind</span><span class="p">))</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">end</span>

    <span class="n">params</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">param_range</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">ss_val_temp</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">ll_temp</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">ss_temp</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">part</span><span class="p">,</span> <span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">val_ind</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">partitions</span><span class="p">):</span>
            <span class="n">x_tr</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">x_val</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">val_ind</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">y_tr</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">val_ind</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">num_val_data</span> <span class="o">=</span> <span class="n">x_val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x_tr</span><span class="p">,</span> <span class="n">y_tr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="n">ss_temp</span> <span class="o">+=</span> <span class="n">m</span><span class="o">.</span><span class="n">objective</span><span class="p">()</span>
            <span class="n">ll_temp</span> <span class="o">+=</span> <span class="n">m</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">()</span>
            <span class="n">f_val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_val</span><span class="p">)</span>
            <span class="n">ss_val_temp</span> <span class="o">+=</span> <span class="p">((</span><span class="n">y_val</span><span class="o">-</span><span class="n">f_val</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> 
            <span class="n">plot_fit</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">param_name</span><span class="o">=</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_range</span><span class="o">=</span><span class="n">param_range</span><span class="p">,</span>
                     <span class="n">objective</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">objective_ylim</span><span class="o">=</span><span class="n">objective_ylim</span><span class="p">,</span>
                     <span class="n">fig</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;olympic_</span><span class="si">{num_parts}</span><span class="s1">cv</span><span class="si">{part:0&gt;2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_parts</span><span class="o">=</span><span class="n">num_parts</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="n">part</span><span class="p">),</span>
                     <span class="n">title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{num_parts}</span><span class="s1">-fold Cross Validation&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_parts</span><span class="o">=</span><span class="n">num_parts</span><span class="p">),</span>
                     <span class="n">x_val</span><span class="o">=</span><span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span><span class="o">=</span><span class="n">y_val</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
        <span class="n">ss_val</span> <span class="o">=</span> <span class="n">ss_val_temp</span><span class="o">/</span><span class="p">(</span><span class="n">num_parts</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="n">ss_temp</span><span class="o">/</span><span class="p">(</span><span class="n">num_parts</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="n">ll_temp</span><span class="o">/</span><span class="p">(</span><span class="n">num_parts</span><span class="p">)</span>
        <span class="n">plot_fit</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">param_name</span><span class="o">=</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_range</span><span class="o">=</span><span class="n">param_range</span><span class="p">,</span>
                 <span class="n">objective</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ss_val</span><span class="p">),</span> <span class="n">objective_ylim</span><span class="o">=</span><span class="n">objective_ylim</span><span class="p">,</span>
                 <span class="n">fig</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                 <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;olympic_</span><span class="si">{num_parts}</span><span class="s1">cv</span><span class="si">{num_partitions:0&gt;2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_parts</span><span class="o">=</span><span class="n">num_parts</span><span class="p">,</span> <span class="n">num_partitions</span><span class="o">=</span><span class="n">num_parts</span><span class="p">),</span>
                 <span class="n">title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{num_parts}</span><span class="s1">-fold Cross Validation&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_parts</span><span class="o">=</span><span class="n">num_parts</span><span class="p">),</span>
                 <span class="n">x_val</span><span class="o">=</span><span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span><span class="o">=</span><span class="n">y_val</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span></div>

            
<span class="c1">#################### Session 6 ####################    </span>

<div class="viewcode-block" id="under_determined_system">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.under_determined_system">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">under_determined_system</span><span class="p">(</span><span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize what happens in an under determined system with linear regression.</span>

<span class="sd">    :param diagrams: Directory to save the plots (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mf">3.</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;under_determined_system000.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="mi">2</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">x</span>
        <span class="n">yvals</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">xvals</span><span class="o">+</span><span class="n">c</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">9</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;under_determined_system</span><span class="si">{count:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">),</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                              <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="bayes_update">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.bayes_update">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bayes_update</span><span class="p">(</span><span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize Bayesian updating with a simple example.</span>

<span class="sd">    :param diagrams: Directory to save the plots (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="n">num_points</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">x_min</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span><span class="p">]])</span>
    <span class="n">prior_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">]])</span>
    <span class="n">prior_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">.1</span><span class="p">]])</span>

    <span class="n">noise</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.6</span><span class="p">]),</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)))</span>


    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">num_points</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">ln_prior_curve</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">prior_var</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">prior_mean</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">prior_mean</span><span class="p">)</span><span class="o">/</span><span class="n">prior_var</span><span class="p">)</span>
    <span class="n">ln_likelihood_curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ln_prior_curve</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
        <span class="n">ln_likelihood_curve</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">noise</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> 
                                                      <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">]]),</span> 
                                                      <span class="n">y</span><span class="p">)</span>
    <span class="n">ln_marginal_likelihood</span> <span class="o">=</span> <span class="n">noise</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">prior_mean</span><span class="p">,</span> <span class="n">prior_var</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="n">prior_curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ln_prior_curve</span><span class="p">)</span> 
    <span class="n">likelihood_curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ln_likelihood_curve</span><span class="p">)</span>
    <span class="n">marginal_curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ln_marginal_likelihood</span><span class="p">)</span>

    <span class="n">ln_posterior_curve</span> <span class="o">=</span> <span class="n">ln_likelihood_curve</span> <span class="o">+</span> <span class="n">ln_prior_curve</span> <span class="o">-</span> <span class="n">ln_marginal_likelihood</span>
    <span class="n">posterior_curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ln_posterior_curve</span><span class="p">)</span>

    <span class="n">g</span><span class="p">,</span> <span class="n">dlnZ_dvs</span> <span class="o">=</span> <span class="n">noise</span><span class="o">.</span><span class="n">grad_vals</span><span class="p">(</span><span class="n">prior_mean</span><span class="p">,</span> <span class="n">prior_var</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="n">nu</span> <span class="o">=</span> <span class="n">g</span><span class="o">*</span><span class="n">g</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">dlnZ_dvs</span>

    <span class="n">approx_var</span> <span class="o">=</span> <span class="n">prior_var</span> <span class="o">-</span> <span class="n">prior_var</span><span class="o">*</span><span class="n">prior_var</span><span class="o">*</span><span class="n">nu</span>
    <span class="n">approx_mean</span> <span class="o">=</span> <span class="n">prior_mean</span> <span class="o">+</span> <span class="n">prior_var</span><span class="o">*</span><span class="n">g</span>

    <span class="n">ln_approx_curve</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">approx_var</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">approx_mean</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">approx_mean</span><span class="p">)</span><span class="o">/</span><span class="n">approx_var</span>

    <span class="n">approx_curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ln_approx_curve</span><span class="p">)</span>
    <span class="n">noise</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">]</span> 
    <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">approx_curve</span><span class="p">,</span> <span class="n">likelihood_curve</span><span class="p">,</span> 
                          <span class="n">posterior_curve</span><span class="p">,</span> <span class="n">prior_curve</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">*</span><span class="mf">1.1</span><span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span> 
    <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span> 

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">prior_curve</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$p(c) = \mathscr</span><span class="si">{N}</span><span class="s1">(c|0, \alpha_1)$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;dem_gaussian001.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">likelihood_curve</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$p(y|m, c, x, \sigma^2)=\mathscr</span><span class="si">{N}</span><span class="s1">(y|mx+c,\sigma^2)$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;dem_gaussian002.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">posterior_curve</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$p(c|y, m, x, \sigma^2)=$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mathscr</span><span class="si">{N}</span><span class="s1">\left(c|\frac{y-mx}{1+\sigma^2\alpha_1},(\sigma^{-2}+\alpha_1^{-1})^{-1}\right)$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;dem_gaussian003.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="height_weight">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.height_weight">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">height_weight</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">muh</span><span class="o">=</span><span class="mf">1.7</span><span class="p">,</span> <span class="n">varh</span><span class="o">=</span><span class="mf">0.0225</span><span class="p">,</span>
                  <span class="n">muw</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">varw</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot height and weight data with Gaussian distributions.</span>

<span class="sd">    :param h: Height data (optional).</span>
<span class="sd">    :param w: Weight data (optional).</span>
<span class="sd">    :param muh: Mean height (default: 1.7).</span>
<span class="sd">    :param varh: Variance of height (default: 0.0225).</span>
<span class="sd">    :param muw: Mean weight (default: 75).</span>
<span class="sd">    :param varw: Variance of weight (default: 36).</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">2.15</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="n">ph</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tau</span><span class="o">*</span><span class="n">varh</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">varh</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">muh</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">pw</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tau</span><span class="o">*</span><span class="n">varw</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">varw</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">muw</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>

    <span class="n">height</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h</span><span class="p">,</span> <span class="n">ph</span><span class="p">)</span>

    <span class="n">weight</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">pw</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;height_weight_gaussian.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="independent_height_weight">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.independent_height_weight">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">independent_height_weight</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">muh</span><span class="o">=</span><span class="mf">1.7</span><span class="p">,</span> <span class="n">varh</span><span class="o">=</span><span class="mf">0.0225</span><span class="p">,</span>
                              <span class="n">muw</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">varw</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span> <span class="n">num_samps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                              <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot independent height and weight samples.</span>

<span class="sd">    :param h: Height data (optional).</span>
<span class="sd">    :param w: Weight data (optional).</span>
<span class="sd">    :param muh: Mean height (default: 1.7).</span>
<span class="sd">    :param varh: Variance of height (default: 0.0225).</span>
<span class="sd">    :param muw: Mean weight (default: 75).</span>
<span class="sd">    :param varw: Variance of weight (default: 36).</span>
<span class="sd">    :param num_samps: Number of samples to generate (default: 20).</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">2.15</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="n">ph</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tau</span><span class="o">*</span><span class="n">varh</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">varh</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">muh</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">pw</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tau</span><span class="o">*</span><span class="n">varw</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">varw</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">muw</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">muh</span><span class="p">,</span> <span class="n">muw</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">xel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varh</span><span class="p">)</span> <span class="o">+</span> <span class="n">muh</span>
    <span class="n">yel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varw</span><span class="p">)</span> <span class="o">+</span> <span class="n">muw</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xel</span><span class="p">,</span> <span class="n">yel</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h</span><span class="p">)])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">65</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">85</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">2.15</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$h/m$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$w/kg$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>

    <span class="n">height</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">h</span><span class="p">,</span> <span class="n">ph</span><span class="p">)</span>
    <span class="n">weight</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">pw</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>


    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samps</span><span class="p">):</span>
        <span class="n">hval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varh</span><span class="p">)</span> <span class="o">+</span> <span class="n">muh</span>
        <span class="n">wval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varw</span><span class="p">)</span> <span class="o">+</span> <span class="n">muw</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hval</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
        <span class="c1">#ma.write_figure(figure=fig, filename=os.path.join(diagrams, &#39;independent_height_weight{count:0&gt;3}.svg&#39;).format(count=count), transparent=True)</span>
        <span class="c1">#count+=1</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wval</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
        <span class="c1">#ma.write_figure(figure=fig, filename=os.path.join(diagrams, &#39;independent_height_weight{count:0&gt;3}.svg&#39;).format(count=count), transparent=True)</span>
        <span class="c1">#count+=1</span>
        <span class="n">a0</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hval</span><span class="p">,</span> <span class="n">wval</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;independent_height_weight</span><span class="si">{count:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">a0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span>
        <span class="n">a1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span>
        <span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span></div>

        
        <span class="c1">#ma.write_figure(figure=fig, filename=os.path.join(diagrams, &#39;independent_height_weight{count:0&gt;3}.svg&#39;).format(count=count), transparent=True)</span>
        <span class="c1">#count+=1</span>

<div class="viewcode-block" id="correlated_height_weight">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.correlated_height_weight">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">correlated_height_weight</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">muh</span><span class="o">=</span><span class="mf">1.7</span><span class="p">,</span> <span class="n">varh</span><span class="o">=</span><span class="mf">0.0225</span><span class="p">,</span>
                             <span class="n">muw</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">varw</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span> <span class="n">num_samps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot correlated height and weight samples.</span>

<span class="sd">    :param h: Height data (optional).</span>
<span class="sd">    :param w: Weight data (optional).</span>
<span class="sd">    :param muh: Mean height (default: 1.7).</span>
<span class="sd">    :param varh: Variance of height (default: 0.0225).</span>
<span class="sd">    :param muw: Mean weight (default: 75).</span>
<span class="sd">    :param varw: Variance of weight (default: 36).</span>
<span class="sd">    :param num_samps: Number of samples to generate (default: 20).</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">diagrams</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">2.15</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="n">ph</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tau</span><span class="o">*</span><span class="n">varh</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">varh</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">muh</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">pw</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tau</span><span class="o">*</span><span class="n">varw</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">varw</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">muw</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>

    <span class="n">covMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.995</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.995</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="n">fact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varh</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varw</span><span class="p">)]])</span>
    <span class="n">covMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">fact</span><span class="p">,</span><span class="n">covMat</span><span class="p">),</span> <span class="n">fact</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">covMat</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">muh</span><span class="p">,</span> <span class="n">muw</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">xel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varh</span><span class="p">)</span>
    <span class="n">yel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varw</span><span class="p">)</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">xel</span><span class="p">,</span> <span class="n">yel</span><span class="p">]))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">+</span><span class="n">muh</span><span class="p">,</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">+</span><span class="n">muw</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h</span><span class="p">)])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">65</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">85</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">2.15</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$h/m$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$w/kg$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">height</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">h</span><span class="p">,</span> <span class="n">ph</span><span class="p">)</span>
    <span class="n">weight</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">pw</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samps</span><span class="p">):</span>
        <span class="n">vec_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">fact</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
        <span class="n">hval</span> <span class="o">=</span> <span class="n">vec_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">muh</span>
        <span class="n">wval</span> <span class="o">=</span> <span class="n">vec_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">muw</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hval</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
        <span class="c1">#ma.write_figure(figure=fig, filename=os.path.join(diagrams, &#39;correlated_height_weight{count:0&gt;3}.svg&#39;).format(count=count), transparent=True)</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wval</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
        <span class="c1">#count+=1</span>
        <span class="c1">#ma.write_figure(figure=fig, filename=os.path.join(diagrams, &#39;correlated_height_weight{count:0&gt;3}.svg&#39;).format(count=count), transparent=True)</span>

        <span class="n">a0</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hval</span><span class="p">,</span> <span class="n">wval</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
        <span class="c1">#count+=1</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;correlated_height_weight</span><span class="si">{count:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#count+=1</span>

        <span class="n">a0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span>
        <span class="n">a1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span>
        <span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span>

        <span class="c1">#ma.write_figure(figure=fig, filename=os.path.join(diagrams, &#39;correlated_height_weight{count:0&gt;3}.svg&#39;).format(count=count), transparent=True)</span>
        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span></div>





<span class="c1">#################### Session 11 ####################</span>


<div class="viewcode-block" id="two_point_pred">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.two_point_pred">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">two_point_pred</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                   <span class="n">conditional_linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                   <span class="n">conditional_linecolor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                   <span class="n">conditional_size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
                   <span class="n">fixed_linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                   <span class="n">fixed_linecolor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                   <span class="n">fixed_size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">stub</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot two-point prediction for Gaussian processes.</span>

<span class="sd">    :param K: Covariance matrix.</span>
<span class="sd">    :param f: Function values.</span>
<span class="sd">    :param x: Input points.</span>
<span class="sd">    :param ax: Matplotlib axis (optional).</span>
<span class="sd">    :param ind: Indices to plot (default: [0, 1]).</span>
<span class="sd">    :param conditional_linestyle: Line style for conditional (default: &#39;-&#39;).</span>
<span class="sd">    :param conditional_linecolor: Color for conditional (default: red).</span>
<span class="sd">    :param conditional_size: Line width for conditional (default: 4).</span>
<span class="sd">    :param fixed_linestyle: Line style for fixed (default: &#39;-&#39;).</span>
<span class="sd">    :param fixed_linecolor: Color for fixed (default: green).</span>
<span class="sd">    :param fixed_size: Line width for fixed (default: 4).</span>
<span class="sd">    :param stub: Stub parameter (optional).</span>
<span class="sd">    :param start: Starting index (default: 0).</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">diagrams</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">diagrams</span><span class="p">)</span>
    
    <span class="n">subK</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">ind</span><span class="p">][:,</span> <span class="n">ind</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">cont</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">cent</span> <span class="o">=</span> <span class="n">base_plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{stub}{start:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="n">stub</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">x_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">cont2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">fixed_size</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">fixed_linestyle</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">fixed_linecolor</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">cont2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">stub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{stub}{start:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="n">stub</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># # Compute conditional mean and variance</span>
    <span class="n">f2_mean</span> <span class="o">=</span> <span class="n">subK</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">subK</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">f2_var</span> <span class="o">=</span> <span class="n">subK</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">subK</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">subK</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">subK</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">x_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">pdf_val</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">f2_var</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x_val</span><span class="o">-</span><span class="n">f2_mean</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x_val</span><span class="o">-</span><span class="n">f2_mean</span><span class="p">)</span><span class="o">/</span><span class="n">f2_var</span><span class="p">)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span><span class="n">x_val</span><span class="p">,</span> <span class="n">pdf_val</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">conditional_size</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">conditional_linestyle</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">conditional_linecolor</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{stub}{start:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="n">stub</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">obs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">fixed_linecolor</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{stub}{start:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="n">stub</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    

<div class="viewcode-block" id="output_augment_x">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.output_augment_x">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">output_augment_x</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Augment input x with output dimensions.</span>

<span class="sd">    :param x: Input data.</span>
<span class="sd">    :param num_outputs: Number of outputs.</span>
<span class="sd">    :returns: Augmented input data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_data</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">num_outputs</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_outputs</span><span class="p">):</span>
        <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_data</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">index</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="basis">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.basis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">basis</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;./diagrams&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">num_basis</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">num_plots</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot basis functions.</span>

<span class="sd">    :param function: Basis function to plot.</span>
<span class="sd">    :param x_min: Minimum x value.</span>
<span class="sd">    :param x_max: Maximum x value.</span>
<span class="sd">    :param fig: Matplotlib figure.</span>
<span class="sd">    :param ax: Matplotlib axis.</span>
<span class="sd">    :param loc: Location for text.</span>
<span class="sd">    :param text: Text to display.</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;./diagrams&#39;).</span>
<span class="sd">    :param fontsize: Font size (default: 20).</span>
<span class="sd">    :param num_basis: Number of basis functions (default: 3).</span>
<span class="sd">    :param num_plots: Number of plots (default: 3).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">diagrams</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="n">basis</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">Basis</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">num_basis</span><span class="p">)</span>
    <span class="n">Phi</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">Phi</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">diag</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">basis</span><span class="o">.</span><span class="n">number</span><span class="o">*</span><span class="p">(</span><span class="n">Phi</span><span class="o">*</span><span class="n">Phi</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Set ylim according to max standard deviation of basis</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">diag</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>    
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">))</span>    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\phi(x)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">basis</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Phi</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">basis</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;_basis</span><span class="si">{num:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Set ylim according to max standard deviation of basis</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">diag</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span> 
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$f(x)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">basis</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">a</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">basis</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Phi</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 

    <span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">basis</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;$w_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; = 0$&#39;</span><span class="p">,</span>
                         <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                         <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_plots</span><span class="p">):</span>
        <span class="c1"># Sample a function</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">basis</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">basis</span><span class="o">.</span><span class="n">number</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Phi</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">basis</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;$w_</span><span class="si">{ind}</span><span class="s1"> = </span><span class="si">{w:3.3}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>

        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">basis</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;_function</span><span class="si">{plot_num:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plot_num</span><span class="o">=</span><span class="n">j</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>  <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="computing_covariance">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.computing_covariance">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">computing_covariance</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> 
                         <span class="n">x</span><span class="p">,</span> 
                         <span class="n">formula</span><span class="p">,</span>
                         <span class="n">stub</span><span class="p">,</span>
                         <span class="n">prec</span><span class="o">=</span><span class="s1">&#39;1.2&#39;</span><span class="p">,</span>
                         <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../slides/diagrams/kern&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize covariance computation.</span>

<span class="sd">    :param kernel: Kernel function.</span>
<span class="sd">    :param x: Input data.</span>
<span class="sd">    :param formula: Formula to display.</span>
<span class="sd">    :param stub: Stub parameter.</span>
<span class="sd">    :param prec: Precision for values (default: &#39;1.2&#39;).</span>
<span class="sd">    :param diagrams: Directory to save the plots (default: &#39;../slides/diagrams/kern&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">diagrams</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="n">counter</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">nsf</span><span class="o">=</span><span class="mi">2</span>
    <span class="n">base_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">data_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
        <span class="n">data_text</span> <span class="o">+=</span> <span class="s1">&#39;$x_</span><span class="si">{i}</span><span class="s1">={val:</span><span class="si">{prec}</span><span class="s1">}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">,</span><span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">data_text</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span>
        <span class="k">elif</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data_text</span> <span class="o">+=</span> <span class="s1">&#39; and &#39;</span>
    <span class="n">param_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kernel</span><span class="o">.</span><span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">notation_map</span><span class="p">:</span>
            <span class="n">param_text</span> <span class="o">+=</span> <span class="s1">&#39;$&#39;</span> <span class="o">+</span> <span class="n">notation_map</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_text</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;$\text{&#39;</span> <span class="o">+</span> <span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span> 
        <span class="n">param_text</span> <span class="o">+=</span> <span class="s1">&#39;={param:</span><span class="si">{prec}</span><span class="s1">}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="n">kernel</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">],</span><span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">kernel</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">param_text</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span>
        <span class="k">elif</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">kernel</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">param_text</span> <span class="o">+=</span> <span class="s1">&#39; and &#39;</span>
            
    <span class="n">base_text</span> <span class="o">+=</span> <span class="n">data_text</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kernel</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">base_text</span> <span class="o">+=</span> <span class="s1">&#39; with &#39;</span> <span class="o">+</span> <span class="n">param_text</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">clear_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">base_text</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="n">clear_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">KplotFull</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
    <span class="n">Kplot</span> <span class="o">=</span> <span class="n">KplotFull</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">KplotFull</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{value:</span><span class="si">{prec}</span><span class="s1">}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">)</span>
            <span class="n">Kplot</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">base_file_name</span> <span class="o">=</span> <span class="s1">&#39;computing_</span><span class="si">{stub}</span><span class="s1">_covariance&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="n">stub</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;$x_</span><span class="si">{i}</span><span class="s1">={val_i:</span><span class="si">{prec}</span><span class="s1">}$, $x_</span><span class="si">{j}</span><span class="s1">={val_j:</span><span class="si">{prec}</span><span class="s1">}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">val_i</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">val_j</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="c1">#a.append(ax[0].text(0.25, 0.4, </span>
            <span class="c1">#                    [r&#39;$\kernelScalar_{&#39; num2str(i) &#39;, &#39; num2str(j) &#39;} = &#39; numsf2str(variance, nsf) &#39; \times \exp \left(-\frac{(&#39; numsf2str(t(i), nsf) &#39;-&#39; numsf2str(t(j), nsf) &#39;)^2}{2\times &#39; numsf2str(lengthScale, nsf) &#39;^2}\right)$&#39;], &#39;horizontalalignment&#39;, &#39;center&#39;)])</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">base_file_name</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">Kplot</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">KplotFull</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

            <span class="n">matrix</span><span class="p">(</span><span class="n">Kplot</span><span class="p">,</span> 
                   <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                   <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> 
                   <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                   <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">highlight_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span>
                   <span class="n">highlight_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                   <span class="n">highlight_color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">base_file_name</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> 
                              <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span><span class="mi">1</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">Kplot</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">KplotFull</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>

                <span class="n">matrix</span><span class="p">(</span><span class="n">Kplot</span><span class="p">,</span> 
                       <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                       <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> 
                       <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                       <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">highlight_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                       <span class="n">highlight_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span>
                       <span class="n">highlight_color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">base_file_name</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
                <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                                  <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">matrix</span><span class="p">(</span><span class="n">Kplot</span><span class="p">,</span> 
           <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
           <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> 
           <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="n">base_file_name</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> 
           <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
           <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span>
           <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">base_file_name</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{counter:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> 
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span></div>

            
<div class="viewcode-block" id="kern_circular_sample">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.kern_circular_sample">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">kern_circular_sample</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_samps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                         <span class="n">num_theta</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample from a circular kernel and create animation.</span>

<span class="sd">    :param K: Kernel function.</span>
<span class="sd">    :param mu: Mean (optional).</span>
<span class="sd">    :param x: Input data (optional).</span>
<span class="sd">    :param filename: Output filename (optional).</span>
<span class="sd">    :param fig: Matplotlib figure (optional).</span>
<span class="sd">    :param num_samps: Number of samples (default: 5).</span>
<span class="sd">    :param num_theta: Number of theta values (default: 48).</span>
<span class="sd">    :param multiple: Whether to show multiple samples (default: True).</span>
<span class="sd">    :param diagrams: Directory to save the plots (default: &#39;../diagrams&#39;).</span>
<span class="sd">    :param **kwargs: Additional keyword arguments.</span>
<span class="sd">    :returns: Animation object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">diagrams</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">diagrams</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
            <span class="n">n</span><span class="o">=</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">num_samps</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">output_augment_x</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">num_samps</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    
    <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
        <span class="n">R1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">num_samps</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">num_samps</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">R1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">num_samps</span><span class="p">))</span>
        <span class="n">R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">num_samps</span><span class="p">))</span>
        
    <span class="n">U1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">R1</span><span class="o">*</span><span class="n">R1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))))</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">R2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">R2</span><span class="o">*</span><span class="n">U1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">R1</span><span class="o">*</span><span class="n">R1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">R2</span><span class="o">*</span><span class="n">R2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))))</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">)</span>

    <span class="n">LR1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">R1</span><span class="p">)</span>
    <span class="n">LR2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">R2</span><span class="p">)</span>
    

    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">animation</span>
    <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
        <span class="n">x_lim</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_lim</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
    
    <span class="n">y_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">LR1</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">LR2</span><span class="o">.</span><span class="n">flatten</span><span class="p">())])),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">LR1</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">LR2</span><span class="o">.</span><span class="n">flatten</span><span class="p">())]))])</span>
    
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>

    <span class="n">line</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samps</span><span class="p">):</span>
        <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        
    <span class="c1"># initialization function: plot the background of each frame</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samps</span><span class="p">):</span>
            <span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="n">line</span>

    <span class="c1"># animation function.  This is called sequentially</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">num_theta</span><span class="o">*</span><span class="n">tau</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">yc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="c1"># generate 2d basis in t-d space</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">xc</span><span class="o">*</span><span class="n">R1</span> <span class="o">+</span> <span class="n">yc</span><span class="o">*</span><span class="n">R2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">xc</span><span class="o">*</span><span class="n">LR1</span> <span class="o">+</span> <span class="n">yc</span><span class="o">*</span><span class="n">LR2</span>
        <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">mu</span>
        <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samps</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">end</span>
                <span class="n">end</span> <span class="o">+=</span> <span class="n">n</span>
                <span class="n">line</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">line</span>

    <span class="c1"># call the animator.  blit=True means only re-draw the parts that have changed.</span>
    <span class="k">return</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
                                   <span class="n">frames</span><span class="o">=</span><span class="n">num_theta</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="animate_covariance_function">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.animate_covariance_function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">animate_covariance_function</span><span class="p">(</span><span class="n">kernel_function</span><span class="p">,</span>
                                <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_samps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                <span class="n">multiple</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create animation of covariance function samples.</span>

<span class="sd">    :param kernel_function: Kernel function to sample from.</span>
<span class="sd">    :param x: Input data (optional).</span>
<span class="sd">    :param num_samps: Number of samples (default: 5).</span>
<span class="sd">    :param multiple: Whether to show multiple samples (default: False).</span>
<span class="sd">    :returns: Animation object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">200</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">output_augment_x</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">num_samps</span><span class="p">)</span>
    
    <span class="n">K</span> <span class="o">=</span> <span class="n">kernel_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">K</span><span class="p">,</span> <span class="n">kern_circular_sample</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                                   <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">num_samps</span><span class="o">=</span><span class="n">num_samps</span><span class="p">,</span>
                                   <span class="n">multiple</span><span class="o">=</span><span class="n">multiple</span><span class="p">)</span></div>

    
<span class="k">def</span><span class="w"> </span><span class="nf">_multi_output_covariance_heatmap</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_outputs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                    <span class="n">shortname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">longname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot multi-output covariance function showing cross-covariances.</span>
<span class="sd">    </span>
<span class="sd">    :param kernel: Multi-output kernel function (e.g., icm_cov, lmc_cov)</span>
<span class="sd">    :param x: Input data (optional)</span>
<span class="sd">    :param num_outputs: Number of outputs to visualize</span>
<span class="sd">    :param shortname: Short name for the kernel (optional)</span>
<span class="sd">    :param longname: Long name for the kernel (optional) </span>
<span class="sd">    :param comment: Comment to display (optional)</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">diagrams</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">diagrams</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        
    <span class="c1"># Create multi-output input data</span>
    <span class="c1"># For each output i, create inputs [i, x1, x2, ...]</span>
    <span class="n">x_multi</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_outputs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x_val</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">x_val</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">x_multi</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_val</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x_multi</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_val</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">x_multi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_multi</span><span class="p">)</span>
    
    <span class="n">K2</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">x_multi</span><span class="p">[::</span><span class="mi">10</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>
    <span class="n">hcolor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span>
                 <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;boxes&#39;</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
    
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">shortname</span> <span class="o">+</span> <span class="s1">&#39;_covariance.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_multi_output_sample_plot</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_outputs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_samps</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                             <span class="n">shortname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot samples from multi-output kernel showing different outputs.</span>
<span class="sd">    </span>
<span class="sd">    :param kernel: Multi-output kernel function (e.g., icm_cov, lmc_cov)</span>
<span class="sd">    :param x: Input data (optional)</span>
<span class="sd">    :param num_outputs: Number of outputs to visualize</span>
<span class="sd">    :param num_samps: Number of samples to draw</span>
<span class="sd">    :param shortname: Short name for the kernel (optional)</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">diagrams</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">diagrams</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    
    <span class="c1"># Create multi-output input data</span>
    <span class="n">x_multi</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_outputs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x_val</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x_val</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">x_multi</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_val</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x_multi</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_val</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">x_multi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_multi</span><span class="p">)</span>
    
    <span class="c1"># Compute full covariance matrix</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">x_multi</span><span class="p">,</span> <span class="n">x_multi</span><span class="p">)</span>
    
    <span class="c1"># Sample from the GP</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_multi</span><span class="p">)),</span> <span class="n">K</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    
    <span class="c1"># Create visualisation</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>
    
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">output_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_outputs</span><span class="p">):</span>
        <span class="c1"># Extract samples for this output</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">output_idx</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">output_idx</span><span class="p">],</span> 
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="c1"># Save plot</span>
    <span class="k">if</span> <span class="n">shortname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">shortname</span> <span class="o">+</span> <span class="s1">&#39;_samples&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;multi_output_samples&#39;</span>
    
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_multi_output_animate_covariance_function</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_outputs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_samps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                             <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create animation of multi-output covariance function samples using great circle tour.</span>
<span class="sd">    </span>
<span class="sd">    :param kernel: Multi-output kernel function (e.g., icm_cov, lmc_cov)</span>
<span class="sd">    :param x: Input data (optional)</span>
<span class="sd">    :param num_outputs: Number of outputs to visualize</span>
<span class="sd">    :param num_samps: Number of samples to draw</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;)</span>
<span class="sd">    :returns: Animation object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    
    <span class="c1"># Create multi-output input data</span>
    <span class="n">x_multi</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_outputs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x_val</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x_val</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">x_multi</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_val</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x_multi</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_val</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">x_multi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_multi</span><span class="p">)</span>
    
    <span class="c1"># Compute full covariance matrix</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">x_multi</span><span class="p">,</span> <span class="n">x_multi</span><span class="p">)</span>
    
    <span class="c1"># Create figure with subplots for each output</span>
   <span class="c1"># Create visualisation</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">))</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># Will be adjusted based on samples</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
    <span class="c1"># Initialize empty line objects for animation</span>
    <span class="n">output_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">output_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_outputs</span><span class="p">):</span>
        <span class="c1"># Create empty lines for each sample</span>
        <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">output_idx</span><span class="p">])</span>
        <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    
    <span class="c1"># Set up great circle tour (similar to kern_circular_sample)</span>
    <span class="n">num_theta</span> <span class="o">=</span> <span class="mi">48</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    
    <span class="c1"># Generate two random vectors for the great circle tour</span>
    <span class="n">R1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_multi</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_multi</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    
    <span class="c1"># Orthogonalize R2 with respect to R1</span>
    <span class="n">U1</span> <span class="o">=</span> <span class="n">R1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">R1</span> <span class="o">*</span> <span class="n">R1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">R2</span> <span class="o">-</span> <span class="n">U1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">R2</span> <span class="o">*</span> <span class="n">U1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">R2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">R1</span> <span class="o">*</span> <span class="n">R1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">R2</span> <span class="o">*</span> <span class="n">R2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    
    <span class="c1"># Cholesky decomposition for sampling</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">K</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span>
    
    <span class="c1"># Transform the random vectors</span>
    <span class="n">LR1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">R1</span><span class="p">)</span>
    <span class="n">LR2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">R2</span><span class="p">)</span>
    
    <span class="c1"># Calculate proper y-limits for the great circle tour</span>
    <span class="c1"># During the animation, we compute y = xc * LR1 + yc * LR2</span>
    <span class="c1"># where xc and yc are cosine and sine values between -1 and 1</span>
    <span class="c1"># The maximum possible value is sqrt(LR1^2 + LR2^2) when xc and yc are aligned</span>
    <span class="c1"># Let&#39;s compute the actual range by sampling a few points in the great circle</span>
    
    <span class="c1"># Sample a few points to get the actual range</span>
    <span class="n">test_thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">all_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">test_thetas</span><span class="p">:</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">yc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">y_test</span> <span class="o">=</span> <span class="n">xc</span> <span class="o">*</span> <span class="n">LR1</span> <span class="o">+</span> <span class="n">yc</span> <span class="o">*</span> <span class="n">LR2</span>
        <span class="n">all_values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">all_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span>
    <span class="n">y_margin</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span>
    <span class="n">y_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y_min</span> <span class="o">-</span> <span class="n">y_margin</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">+</span> <span class="n">y_margin</span><span class="p">])</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">animate</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
        <span class="c1"># Great circle tour: interpolate between R1 and R2 using trigonometric functions</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_theta</span> <span class="o">*</span> <span class="n">tau</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">yc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        
        <span class="c1"># Generate samples using the great circle tour</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">xc</span> <span class="o">*</span> <span class="n">LR1</span> <span class="o">+</span> <span class="n">yc</span> <span class="o">*</span> <span class="n">LR2</span>
        
        <span class="c1"># Update each output&#39;s samples</span>
        <span class="k">for</span> <span class="n">output_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_outputs</span><span class="p">):</span>
            <span class="n">start_idx</span> <span class="o">=</span> <span class="n">output_idx</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            
            <span class="n">xc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">yc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">xc</span> <span class="o">*</span> <span class="n">LR1</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yc</span> <span class="o">*</span> <span class="n">LR2</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                
            <span class="n">output_lines</span><span class="p">[</span><span class="n">output_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">output_lines</span>
    
    <span class="c1"># Create animation</span>
    <span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">num_theta</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">K</span><span class="p">,</span> <span class="n">anim</span>

<div class="viewcode-block" id="multi_output_covariance_func">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.multi_output_covariance_func">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">multi_output_covariance_func</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_outputs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                <span class="n">shortname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">longname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">num_samps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Complete multi-output covariance function visualization with both static plots and animation.</span>
<span class="sd">    </span>
<span class="sd">    :param kernel: Multi-output kernel function (e.g., icm_cov, lmc_cov)</span>
<span class="sd">    :param x: Input data (optional)</span>
<span class="sd">    :param num_outputs: Number of outputs to visualize</span>
<span class="sd">    :param shortname: Short name for the kernel (optional)</span>
<span class="sd">    :param longname: Long name for the kernel (optional) </span>
<span class="sd">    :param comment: Comment to display (optional)</span>
<span class="sd">    :param num_samps: Number of samples for animation (default: 5)</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">diagrams</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">diagrams</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">shortname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shortname</span> <span class="o">=</span> <span class="s1">&#39;multi_output&#39;</span>
    
    <span class="c1"># Create static covariance heatmap (save as {shortname}_covariance)</span>
    <span class="n">fig1</span><span class="p">,</span> <span class="n">axes1</span> <span class="o">=</span> <span class="n">_multi_output_covariance_heatmap</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">,</span> <span class="n">shortname</span><span class="p">,</span> <span class="n">longname</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">)</span>
    
    <span class="c1"># Create static sample plot (save as {shortname}_samples)  </span>
    <span class="n">fig2</span><span class="p">,</span> <span class="n">axes2</span> <span class="o">=</span> <span class="n">_multi_output_sample_plot</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">,</span> <span class="n">num_samps</span><span class="p">,</span> <span class="n">shortname</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">)</span>
    
    <span class="c1"># Create animation</span>
    <span class="n">K</span><span class="p">,</span> <span class="n">anim</span> <span class="o">=</span> <span class="n">_multi_output_animate_covariance_function</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">,</span> <span class="n">num_samps</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">)</span>
    
    <span class="c1"># Save animation as {shortname}_covariance.gif (expected by includecovariance macro)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_animation</span><span class="p">(</span><span class="n">anim</span><span class="p">,</span>
                      <span class="n">shortname</span> <span class="o">+</span> <span class="s1">&#39;_covariance.gif&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                      <span class="n">writer</span><span class="o">=</span><span class="s1">&#39;imagemagick&#39;</span><span class="p">,</span>
                      <span class="n">fps</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    
    
    <span class="c1"># Create HTML output similar to covariance_func</span>
    <span class="k">if</span> <span class="n">kernel</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&lt;h2&gt;&#39;</span> <span class="o">+</span> <span class="n">kernel</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; Multi-Output Covariance&lt;/h2&gt;&#39;</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&lt;h2&gt;Multi-Output Covariance&lt;/h2&gt;&#39;</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n</span><span class="se">\n</span><span class="s1">&#39;</span>
    
    <span class="k">if</span> <span class="n">kernel</span><span class="o">.</span><span class="n">formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;&lt;center&gt;&#39;</span> <span class="o">+</span> <span class="n">kernel</span><span class="o">.</span><span class="n">formula</span> <span class="o">+</span> <span class="s1">&#39;&lt;/center&gt;&lt;/p&gt;&#39;</span>
    
    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;&lt;table&gt;</span><span class="se">\\</span><span class="s1">n&#39;</span>
    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;  &lt;tr&gt;&lt;td&gt;&lt;img src=&quot;&#39;</span> <span class="o">+</span> <span class="n">ma</span><span class="o">.</span><span class="n">filename_join</span><span class="p">(</span><span class="n">shortname</span> <span class="o">+</span> <span class="s1">&#39;_covariance&#39;</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.svg&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;img src=&quot;&#39;</span> <span class="o">+</span> <span class="n">ma</span><span class="o">.</span><span class="n">filename_join</span><span class="p">(</span><span class="n">shortname</span> <span class="o">+</span> <span class="s1">&#39;_covariance&#39;</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.gif&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span><span class="se">\\</span><span class="s1">n&#39;</span>
    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;  &lt;tr&gt;&lt;td&gt;&lt;img src=&quot;&#39;</span> <span class="o">+</span> <span class="n">ma</span><span class="o">.</span><span class="n">filename_join</span><span class="p">(</span><span class="n">shortname</span> <span class="o">+</span> <span class="s1">&#39;_samples&#39;</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span><span class="se">\\</span><span class="s1">n&#39;</span>
    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/table&gt;&#39;</span>
    
    <span class="k">if</span> <span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;&lt;center&gt;&#39;</span> <span class="o">+</span> <span class="n">comment</span> <span class="o">+</span> <span class="s1">&#39;&lt;/center&gt;&lt;/p&gt;&#39;</span>
    
    <span class="n">fhand</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">filename_join</span><span class="p">(</span><span class="n">shortname</span> <span class="o">+</span> <span class="s1">&#39;_covariance.html&#39;</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">fhand</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">fhand</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="c1"># Public wrapper functions for individual components</span>
<div class="viewcode-block" id="multi_output_covariance_heatmap">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.multi_output_covariance_heatmap">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">multi_output_covariance_heatmap</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_outputs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shortname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Public wrapper for multi-output covariance heatmap visualization.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_multi_output_covariance_heatmap</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">,</span> <span class="n">shortname</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">)</span></div>


<div class="viewcode-block" id="multi_output_sample_plot">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.multi_output_sample_plot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">multi_output_sample_plot</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_outputs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_samps</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shortname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Public wrapper for multi-output sample plot visualization.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_multi_output_sample_plot</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">,</span> <span class="n">num_samps</span><span class="p">,</span> <span class="n">shortname</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">)</span></div>


<div class="viewcode-block" id="multi_output_animate_covariance_function">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.multi_output_animate_covariance_function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">multi_output_animate_covariance_function</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_outputs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_samps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Public wrapper for multi-output animated covariance function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_multi_output_animate_covariance_function</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">,</span> <span class="n">num_samps</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">)</span></div>


<div class="viewcode-block" id="covariance_func">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.covariance_func">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">covariance_func</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">shortname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">longname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">num_samps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot covariance function samples.</span>

<span class="sd">    :param kernel: Kernel function to sample from.</span>
<span class="sd">    :param x: Input data (optional).</span>
<span class="sd">    :param shortname: Short name for the kernel (optional).</span>
<span class="sd">    :param longname: Long name for the kernel (optional).</span>
<span class="sd">    :param comment: Comment to display (optional).</span>
<span class="sd">    :param num_samps: Number of samples (default: 5).</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    :param multiple: Whether to show multiple samples (default: False).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">diagrams</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">diagrams</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">200</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        
    <span class="n">K</span><span class="p">,</span> <span class="n">anim</span><span class="o">=</span><span class="n">animate_covariance_function</span><span class="p">(</span><span class="n">kernel</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">num_samps</span><span class="p">,</span>
                                        <span class="n">multiple</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">kernel</span><span class="o">.</span><span class="n">shortname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">shortname</span> <span class="o">+</span> <span class="s1">&#39;_covariance&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;covariance&#39;</span>

    <span class="n">ma</span><span class="o">.</span><span class="n">write_animation</span><span class="p">(</span><span class="n">anim</span><span class="p">,</span>
                         <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.gif&#39;</span><span class="p">,</span>
                         <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                         <span class="n">writer</span><span class="o">=</span><span class="s1">&#39;imagemagick&#39;</span><span class="p">,</span>
                         <span class="n">fps</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>


    <span class="n">K2</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">x</span><span class="p">[::</span><span class="mi">10</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>
    <span class="n">hcolor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span>
                 <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;boxes&#39;</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">kernel</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&lt;h2&gt;&#39;</span> <span class="o">+</span> <span class="n">kernel</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; Covariance&lt;/h2&gt;&#39;</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">kernel</span><span class="o">.</span><span class="n">formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;&lt;center&gt;&#39;</span> <span class="o">+</span> <span class="n">kernel</span><span class="o">.</span><span class="n">formula</span> <span class="o">+</span> <span class="s1">&#39;&lt;/center&gt;&lt;/p&gt;&#39;</span>
    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;&lt;table&gt;</span><span class="se">\\</span><span class="s1">n  &lt;tr&gt;&lt;td&gt;&lt;img src=&quot;&#39;</span> <span class="o">+</span> <span class="n">ma</span><span class="o">.</span><span class="n">filename_join</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.svg&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;img src=&quot;&#39;</span> <span class="o">+</span> <span class="n">ma</span><span class="o">.</span><span class="n">filename_join</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.gif&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span><span class="se">\\</span><span class="s1">n&lt;/table&gt;&#39;</span>
    <span class="k">if</span> <span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;&lt;center&gt;&#39;</span> <span class="o">+</span> <span class="n">comment</span> <span class="o">+</span> <span class="s1">&#39;&lt;/center&gt;&lt;/p&gt;&#39;</span>
    <span class="n">fhand</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">filename_join</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span><span class="p">,</span> <span class="n">diagrams</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">fhand</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></div>


    
<div class="viewcode-block" id="rejection_samples">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.rejection_samples">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rejection_samples</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_few</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">num_many</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>  <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate rejection samples from a kernel.</span>

<span class="sd">    :param kernel: Kernel function to sample from.</span>
<span class="sd">    :param x: Input data (optional).</span>
<span class="sd">    :param num_few: Number of few samples (default: 20).</span>
<span class="sd">    :param num_many: Number of many samples (default: 1000).</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    :param **kwargs: Additional keyword arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">big_wide_figsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">250</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">resolution</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">resolution</span><span class="p">),</span> <span class="n">K</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_few</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="c1">#ax.set_xticks(range(1, 26, 2))</span>
    <span class="c1">#ax.set_yticks([-1, 0, 1])</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="p">)]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">h_f</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;gp_rejection_sample001.png&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">fnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">resolution</span><span class="p">),</span> <span class="n">K</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_many</span><span class="o">-</span><span class="n">num_few</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">fnew</span><span class="p">))</span>
    <span class="n">h_f</span> <span class="o">+=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fnew</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;gp_rejection_sample002.png&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">resolution</span><span class="o">/</span><span class="mf">5.</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">resolution</span><span class="o">/</span><span class="mf">3.</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">resolution</span><span class="o">/</span><span class="mf">5.</span><span class="p">)]</span>
    <span class="n">K_data</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">ind</span><span class="p">][:,</span> <span class="n">ind</span><span class="p">]</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)),</span> <span class="n">K_data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">h_data</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;gp_rejection_sample003.png&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">y_data</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">del_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dist</span><span class="p">)[</span><span class="mi">10</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">del_ind</span><span class="p">:</span>
        <span class="n">h_f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;gp_rejection_sample004.png&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># This is not the numerically stable way to do this!</span>
    <span class="n">Kinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">K_data</span><span class="p">)</span>
    <span class="n">Kinvy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Kinv</span><span class="p">,</span> <span class="n">y_data</span><span class="p">)</span>
    <span class="n">K_star</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Kinv</span><span class="p">,</span> <span class="n">K_star</span><span class="p">)</span>
    <span class="n">mu_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">y_data</span><span class="p">)</span>
    <span class="n">c_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">K_star</span><span class="p">))[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">GPY_AVAILABLE</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">mlai.gp_tutorial</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpt</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">gpt</span><span class="o">.</span><span class="n">gpplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>
                           <span class="n">mu_f</span><span class="p">,</span>
                           <span class="n">mu_f</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c_f</span><span class="p">),</span>
                           <span class="n">mu_f</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c_f</span><span class="p">),</span> 
                           <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu_f</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="p">(</span><span class="n">mu_f</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c_f</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="p">(</span><span class="n">mu_f</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c_f</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;gp_rejection_sample005.png&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    
    
<div class="viewcode-block" id="two_point_sample">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.two_point_sample">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">two_point_sample</span><span class="p">(</span><span class="n">kernel_function</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample from a two-point kernel function.</span>

<span class="sd">    :param kernel_function: Kernel function to sample from.</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">25</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">kernel_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$i$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$i^\prime$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="c1">#fig.colorbar(mappable=obj, ax=ax[1])</span>
    <span class="c1">#ax[1].set_axis(&#39;off&#39;)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;two_point_sample000.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span> <span class="n">K</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">26</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">26</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$i$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$f$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;two_point_sample001.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ind</span><span class="p">[</span><span class="mi">1</span><span class="p">]]],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hcolor</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;two_point_sample002.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> 
                 <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                 <span class="n">highlight_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
                 <span class="n">highlight_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> 
                 <span class="n">highlight_color</span><span class="o">=</span><span class="n">hcolor</span><span class="p">,</span>
                 <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$i$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$i^\prime$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;two_point_sample003.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> 
                 <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                 <span class="n">highlight_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
                 <span class="n">highlight_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> 
                 <span class="n">highlight_color</span><span class="o">=</span><span class="n">hcolor</span><span class="p">,</span>
                 <span class="n">highlight_width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                 <span class="n">zoom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">zoom_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
                 <span class="n">zoom_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
                 <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$i$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$i^\prime$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;two_point_sample004.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> 
                 <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                 <span class="n">highlight_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
                 <span class="n">highlight_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> 
                 <span class="n">highlight_color</span><span class="o">=</span><span class="n">hcolor</span><span class="p">,</span>
                 <span class="n">highlight_width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                 <span class="n">zoom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">zoom_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                 <span class="n">zoom_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                 <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$i$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$i^\prime$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;two_point_sample005.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> 
                 <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                 <span class="n">highlight_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
                 <span class="n">highlight_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> 
                 <span class="n">highlight_color</span><span class="o">=</span><span class="n">hcolor</span><span class="p">,</span>
                 <span class="n">highlight_width</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                 <span class="n">zoom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">zoom_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                 <span class="n">zoom_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                 <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$i$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$i^\prime$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;two_point_sample006.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> 
                 <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                 <span class="n">highlight_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
                 <span class="n">highlight_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> 
                 <span class="n">highlight_color</span><span class="o">=</span><span class="n">hcolor</span><span class="p">,</span>
                 <span class="n">highlight_width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">zoom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">zoom_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                 <span class="n">zoom_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                 <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$i$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$i^\prime$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;two_point_sample007.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">ind</span><span class="p">][:,</span> <span class="n">ind</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;values&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$i$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$i^\prime$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;two_point_sample008.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">two_point_pred</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span> <span class="n">stub</span><span class="o">=</span><span class="s1">&#39;two_point_sample&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>

    <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">26</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$i$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$f$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ind</span><span class="p">[</span><span class="mi">1</span><span class="p">]]],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hcolor</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">ind</span><span class="p">][:,</span> <span class="n">ind</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;values&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$i$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$i^\prime$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;two_point_sample013.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">two_point_pred</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span> <span class="n">stub</span><span class="o">=</span><span class="s1">&#39;two_point_sample&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span></div>



<div class="viewcode-block" id="poisson">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.poisson">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">poisson</span><span class="p">(</span><span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot Poisson distribution examples.</span>

<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">poisson</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">poisson</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">p3</span> <span class="o">=</span> <span class="n">poisson</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">3.</span><span class="p">)</span>
    <span class="n">p10</span> <span class="o">=</span> <span class="n">poisson</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="s1">&#39;r.-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\lambda=1$&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="s1">&#39;g.-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\lambda=3$&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">p10</span><span class="p">,</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\lambda=10$&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Poisson Distribution&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_i$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$p(y_i)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;poisson.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="logistic">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.logistic">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">logistic</span><span class="p">(</span><span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot logistic function examples.</span>

<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">f</span><span class="p">))</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Logistic Function&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$f_i$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$g_i$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;logistic.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="height">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.height">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">height</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">ph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot height as a distribution.&quot;&quot;&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">2.15</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$h/m$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$p(h)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span></div>

    <span class="c1">#ax.vlines(xlim[0], ylim[0], ylim[1], color=&#39;k&#39;)</span>
    <span class="c1">#ax.hlines(ylim[0], xlim[0], xlim[1], color=&#39;k&#39;)</span>

<div class="viewcode-block" id="weight">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.weight">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">weight</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">pw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot weight distribution.</span>

<span class="sd">    :param ax: Matplotlib axis.</span>
<span class="sd">    :param w: Weight values.</span>
<span class="sd">    :param pw: Weight probabilities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">pw</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">55</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">95</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$w/kg$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$p(w)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span></div>

    <span class="c1">#ax.vlines(xlim[0], ylim[0], ylim[1], color=&#39;k&#39;)</span>
    <span class="c1">#ax.hlines(ylim[0], xlim[0], xlim[1], color=&#39;k&#39;)</span>

<div class="viewcode-block" id="low_rank_approximation">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.low_rank_approximation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">low_rank_approximation</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize low-rank matrix approximation.</span>

<span class="sd">    :param fontsize: Font size for labels (default: 25).</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">big_wide_figsize</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">blank_canvas</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.145</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\times$&#39;</span><span class="p">,</span> 
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$=$&#39;</span><span class="p">,</span> 
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.075</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{U}</span><span class="s1">$&#39;</span><span class="p">,</span> 
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{V}</span><span class="s1">^\top$&#39;</span><span class="p">,</span> 
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{W}</span><span class="s1">$&#39;</span><span class="p">,</span> 
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">VT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
    <span class="n">basewidth</span> <span class="o">=</span> <span class="mf">0.15</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">basewidth</span><span class="p">,</span> <span class="n">basewidth</span><span class="o">/</span><span class="n">q</span><span class="o">*</span><span class="n">k1</span><span class="p">])</span>
    <span class="n">matrix</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">basewidth</span><span class="o">/</span><span class="n">q</span><span class="o">*</span><span class="n">k2</span><span class="p">,</span> <span class="n">basewidth</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">matrix</span><span class="p">(</span><span class="n">VT</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">basewidth</span><span class="o">/</span><span class="n">q</span><span class="o">*</span><span class="n">k2</span><span class="p">,</span> <span class="n">basewidth</span><span class="o">/</span><span class="n">q</span><span class="o">*</span><span class="n">k1</span><span class="p">])</span>
    <span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">VT</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;wisuvt.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    
<span class="k">def</span><span class="w"> </span><span class="nf">kronecker_illustrate</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Illustrate Kronecker product concept.</span>

<span class="sd">    :param fontsize: Font size for labels (default: 25).</span>
<span class="sd">    :param diagrams: Directory to save the plot (default: &#39;../diagrams&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;$a$&#39;</span><span class="p">,</span> <span class="s1">&#39;$b$&#39;</span><span class="p">],</span>
         <span class="p">[</span> <span class="s1">&#39;$c$&#39;</span><span class="p">,</span> <span class="s1">&#39;$d$&#39;</span><span class="p">]]</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{K}</span><span class="s1">$&#39;</span><span class="p">]]</span>

    <span class="n">AkroneckerB</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">r</span><span class="s1">&#39;$a\mathbf</span><span class="si">{K}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$b\mathbf</span><span class="si">{K}</span><span class="s1">$&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$c\mathbf</span><span class="si">{K}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$d\mathbf</span><span class="si">{K}</span><span class="s1">$&#39;</span><span class="p">]]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39; $\otimes$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39; $=$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
    <span class="n">objA</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>


    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">objB</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
    <span class="n">objAkB</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">AkroneckerB</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;kronecker_product.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<div class="viewcode-block" id="blank_canvas">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.blank_canvas">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">blank_canvas</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a blank canvas for plotting.</span>

<span class="sd">    :param ax: Matplotlib axis to clear.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="kronecker_illustrate">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.kronecker_illustrate">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">kronecker_illustrate</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Illustrate a Kronecker product&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;$a$&#39;</span><span class="p">,</span> <span class="s1">&#39;$b$&#39;</span><span class="p">],</span>
         <span class="p">[</span> <span class="s1">&#39;$c$&#39;</span><span class="p">,</span> <span class="s1">&#39;$d$&#39;</span><span class="p">]]</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{K}</span><span class="s1">$&#39;</span><span class="p">]]</span>

    <span class="n">AkroneckerB</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">r</span><span class="s1">&#39;$a\mathbf</span><span class="si">{K}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$b\mathbf</span><span class="si">{K}</span><span class="s1">$&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$c\mathbf</span><span class="si">{K}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$d\mathbf</span><span class="si">{K}</span><span class="s1">$&#39;</span><span class="p">]]</span>

    <span class="n">blank_canvas</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39; $\otimes$&#39;</span><span class="p">,</span>
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39; $=$&#39;</span><span class="p">,</span>
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
    <span class="n">objA</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>


    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">objB</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
    <span class="n">objAkB</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">AkroneckerB</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;kronecker_illustrate.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="kronecker_IK">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.kronecker_IK">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">kronecker_IK</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Illustrate a Kronecker product&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">my_rgb</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],[</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],[</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListedColormap</span>
    <span class="n">colormap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">my_rgb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;primary+black&#39;</span><span class="p">)</span>
    <span class="n">dim_I</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">dim_K</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">dim_I</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_K</span><span class="p">))</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        
    <span class="n">blank_canvas</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39; $\otimes$&#39;</span><span class="p">,</span>
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.615</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39; $=$&#39;</span><span class="p">,</span>
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
    <span class="n">objI</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="mi">1</span><span class="o">-</span><span class="n">I</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;boxes&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;colorpatch&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>


    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
    <span class="n">objK</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">K</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="n">K</span><span class="o">==</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
                  <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                  <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;boxes&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;colorpatch&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
        <span class="n">kron_IK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kron_IK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>    
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.675</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">])</span>
    <span class="n">objAkB</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">kron_IK</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="n">kron_IK</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">kron_IK</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="n">kron_IK</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">kron_IK</span><span class="o">==</span><span class="mi">3</span><span class="p">,</span> <span class="n">kron_IK</span><span class="o">==</span><span class="mi">0</span><span class="p">)),</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;boxes&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;colorpatch&#39;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;kronecker_KI.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;kronecker_IK.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="kronecker_IK_highlight">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.kronecker_IK_highlight">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">kronecker_IK_highlight</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Illustrate a Kronecker product&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">my_rgb</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],[</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],[</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListedColormap</span>
    <span class="n">colormap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">my_rgb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;primary+black&#39;</span><span class="p">)</span>
    <span class="n">dim_I</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">dim_K</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">dim_I</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_K</span><span class="p">))</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
        <span class="n">kron_IK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
        <span class="n">stem</span> <span class="o">=</span> <span class="s1">&#39;KI&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kron_IK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">stem</span> <span class="o">=</span> <span class="s1">&#39;IK&#39;</span>
        
    <span class="n">IK_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">kron_IK</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="n">kron_IK</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">kron_IK</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="n">kron_IK</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">kron_IK</span><span class="o">==</span><span class="mi">3</span><span class="p">,</span> <span class="n">kron_IK</span><span class="o">==</span><span class="mi">0</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)</span>        
    <span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">objAkB</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">IK_stack</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;boxes&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;colorpatch&#39;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;kronecker_</span><span class="si">{stem}</span><span class="s1">_highlighted001.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stem</span><span class="o">=</span><span class="n">stem</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="n">objAkB</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">IK_stack</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;boxes&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;colorpatch&#39;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                    <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                    <span class="n">highlight_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> 
                    <span class="n">highlight_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> 
                    <span class="n">highlight_color</span><span class="o">=</span><span class="n">hcolor</span><span class="p">,</span>
                    <span class="n">highlight_width</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;kronecker_</span><span class="si">{stem}</span><span class="s1">_highlighted002.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stem</span><span class="o">=</span><span class="n">stem</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">for</span> <span class="n">zoom</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="n">objAkB</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">IK_stack</span><span class="p">,</span>
                        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                        <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;boxes&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;colorpatch&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                        <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                        <span class="n">highlight_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> 
                        <span class="n">highlight_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> 
                        <span class="n">highlight_color</span><span class="o">=</span><span class="n">hcolor</span><span class="p">,</span>
                        <span class="n">highlight_width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                        <span class="n">zoom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">zoom_row</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">zoom</span><span class="p">],</span>
                        <span class="n">zoom_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">zoom</span><span class="p">])</span>
        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;kronecker_</span><span class="si">{stem}</span><span class="s1">_highlighted</span><span class="si">{count:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stem</span><span class="o">=</span><span class="n">stem</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">)</span></div>


<div class="viewcode-block" id="kronecker_WX">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.kronecker_WX">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">kronecker_WX</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Illustrate a Kronecker product&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{W}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">],[</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{W}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">],[</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{W}</span><span class="s1">$&#39;</span><span class="p">]]</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{x}</span><span class="s1">_{1,:}$&#39;</span><span class="p">],[</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{x}</span><span class="s1">_{2,:}$&#39;</span><span class="p">],[</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{x}</span><span class="s1">_{3,:}$&#39;</span><span class="p">]]</span>
    <span class="n">AkroneckerB</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{W}</span><span class="s1">\mathbf</span><span class="si">{x}</span><span class="s1">_{1,:}$&#39;</span><span class="p">],[</span> <span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{W}</span><span class="s1">\mathbf</span><span class="si">{x}</span><span class="s1">_{2,:}$&#39;</span><span class="p">],</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{W}</span><span class="s1">\mathbf</span><span class="si">{x}</span><span class="s1">_{3,:}$&#39;</span><span class="p">]]</span>

    <span class="n">blank_canvas</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\times$&#39;</span><span class="p">,</span>
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39; $=$&#39;</span><span class="p">,</span>
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
    <span class="n">objA</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span>
                  <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>


    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
    <span class="n">objB</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                  <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
    <span class="n">objAkB</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">AkroneckerB</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bracket_style</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;kronecker_WX.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="perceptron">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.perceptron">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">perceptron</span><span class="p">(</span><span class="n">x_plus</span><span class="p">,</span> <span class="n">x_minus</span><span class="p">,</span> <span class="n">learn_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_iters</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
               <span class="n">max_updates</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">100001</span><span class="p">,</span> <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit a perceptron algorithm and record iterations of fit&quot;&quot;&quot;</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x_select</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">init_perceptron</span><span class="p">(</span><span class="n">x_plus</span><span class="p">,</span> <span class="n">x_minus</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">updates</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">setup</span><span class="o">=</span><span class="kc">True</span>
    <span class="n">f2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">init_perceptron_plot</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">x_plus</span><span class="p">,</span> <span class="n">x_minus</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">handle</span><span class="p">[</span><span class="s1">&#39;plane&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">handle</span><span class="p">[</span><span class="s1">&#39;arrow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">handle</span><span class="p">[</span><span class="s1">&#39;circle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">x_select</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_select</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">handle</span><span class="p">[</span><span class="s1">&#39;circle&#39;</span><span class="p">])</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;perceptron</span><span class="si">{samp:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">samp</span><span class="o">=</span><span class="n">count</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span><span class="o">.</span><span class="n">transformed</span><span class="p">(</span><span class="n">f2</span><span class="o">.</span><span class="n">dpi_scale_trans</span><span class="o">.</span><span class="n">inverted</span><span class="p">())</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;perceptron</span><span class="si">{samp:0&gt;3}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">samp</span><span class="o">=</span><span class="n">count</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">handle</span><span class="p">[</span><span class="s1">&#39;plane&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">handle</span><span class="p">[</span><span class="s1">&#39;arrow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;perceptron</span><span class="si">{samp:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">samp</span><span class="o">=</span><span class="n">count</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;perceptron</span><span class="si">{samp:0&gt;3}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">samp</span><span class="o">=</span><span class="n">count</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">updates</span><span class="o">&lt;</span><span class="n">max_updates</span> <span class="ow">and</span> <span class="n">iterations</span><span class="o">&lt;</span><span class="n">max_iters</span><span class="p">:</span>
        <span class="n">iterations</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x_select</span><span class="p">,</span> <span class="n">updated</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">update_perceptron</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x_plus</span><span class="p">,</span> <span class="n">x_minus</span><span class="p">,</span> <span class="n">learn_rate</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">updated</span><span class="p">:</span>
            <span class="n">updates</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">handle</span><span class="p">[</span><span class="s1">&#39;circle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">x_select</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_select</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;perceptron</span><span class="si">{samp:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">samp</span><span class="o">=</span><span class="n">count</span><span class="p">),</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>     
            <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;perceptron</span><span class="si">{samp:0&gt;3}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">samp</span><span class="o">=</span><span class="n">count</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>        
            <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">handle</span> <span class="o">=</span> <span class="n">update_perceptron_plot</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">x_plus</span><span class="p">,</span> <span class="n">x_minus</span><span class="p">,</span> <span class="n">updates</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;perceptron</span><span class="si">{samp:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">samp</span><span class="o">=</span><span class="n">count</span><span class="p">),</span>
                              <span class="n">figure</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                              <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;perceptron</span><span class="si">{samp:0&gt;3}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">samp</span><span class="o">=</span><span class="n">count</span><span class="p">),</span>
                              <span class="n">figure</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span> 
                              <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                              <span class="n">bbox_inches</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                              <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data passes:&#39;</span><span class="p">,</span> <span class="n">iterations</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count</span></div>




<div class="viewcode-block" id="dist2">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.dist2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">dist2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computer squared distances between two design matrices&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">Y</span><span class="o">*</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="clear_axes">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.clear_axes">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">clear_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear the axes lines and ticks&quot;&quot;&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>          
                   <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> 
                   <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="non_linear_difficulty_plot_3">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.non_linear_difficulty_plot_3">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">non_linear_difficulty_plot_3</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                 <span class="n">rbf_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                 <span class="n">num_basis_func</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                 <span class="n">num_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">number_across</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                 <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Push a Gaussian density through an RBF network and plot results&quot;&quot;&quot;</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">num_basis_func</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_basis_func</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

    <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">number_across</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span><span class="p">;</span> <span class="n">mu1</span> <span class="o">=</span> <span class="n">mu</span><span class="p">;</span> <span class="n">mu2</span> <span class="o">=</span> <span class="n">mu</span>
    <span class="n">MU1</span><span class="p">,</span> <span class="n">MU2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">mu1</span><span class="p">,</span> <span class="n">mu2</span><span class="p">)</span>
    <span class="n">X1</span><span class="p">,</span> <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">X1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">X2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span>

    <span class="n">MU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">MU1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">MU2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span>
    <span class="n">num_basis_func</span> <span class="o">=</span> <span class="n">MU</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dist2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">MU</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">rbf_width</span><span class="o">*</span><span class="n">rbf_width</span><span class="p">))</span>
    <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_basis_func</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Phi</span><span class="p">,</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

    <span class="n">start_val</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_across</span><span class="p">):</span>
          <span class="n">end_val</span> <span class="o">=</span> <span class="n">number_across</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
          <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">start_val</span><span class="p">:</span><span class="n">end_val</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">start_val</span><span class="p">:</span><span class="n">end_val</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
          <span class="n">start_val</span> <span class="o">=</span> <span class="n">end_val</span>

    <span class="c1"># Reshape X to plot lines in opposite directions</span>
    <span class="n">X1</span> <span class="o">=</span> <span class="n">X1</span><span class="o">.</span><span class="n">T</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="n">X2</span><span class="o">.</span><span class="n">T</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">X1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">X2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span>
    <span class="n">start_val</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_across</span><span class="p">):</span>
          <span class="n">end_val</span> <span class="o">=</span> <span class="n">number_across</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
          <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">start_val</span><span class="p">:</span><span class="n">end_val</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">start_val</span><span class="p">:</span><span class="n">end_val</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
          <span class="n">start_val</span> <span class="o">=</span> <span class="n">end_val</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>          
        <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">clear_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">start_val</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_across</span><span class="p">):</span>
          <span class="n">end_val</span> <span class="o">=</span> <span class="n">number_across</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
          <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">F</span><span class="p">[</span><span class="n">start_val</span><span class="p">:</span><span class="n">end_val</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                            <span class="n">F</span><span class="p">[</span><span class="n">start_val</span><span class="p">:</span><span class="n">end_val</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
                            <span class="n">F</span><span class="p">[</span><span class="n">start_val</span><span class="p">:</span><span class="n">end_val</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> 
                            <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
          <span class="n">start_val</span> <span class="o">=</span> <span class="n">end_val</span>

    <span class="c1"># Reshape F to plot lines in opposite directions</span>
    <span class="n">F1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">F</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
    <span class="n">F2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">F</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
    <span class="n">F3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">F</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">F1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">F2</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">F3</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span>

    <span class="n">start_val</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_across</span><span class="p">):</span>
          <span class="n">end_val</span> <span class="o">=</span> <span class="n">number_across</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
          <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">F</span><span class="p">[</span><span class="n">start_val</span><span class="p">:</span><span class="n">end_val</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                            <span class="n">F</span><span class="p">[</span><span class="n">start_val</span><span class="p">:</span><span class="n">end_val</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
                            <span class="n">F</span><span class="p">[</span><span class="n">start_val</span><span class="p">:</span><span class="n">end_val</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                            <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
          <span class="n">start_val</span> <span class="o">=</span> <span class="n">end_val</span>

    <span class="c1"># Treble axis size to increase plot size</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">scale</span><span class="o">=</span><span class="mf">2.5</span>
    <span class="n">npos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="n">pos</span><span class="o">.</span><span class="n">width</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span> <span class="n">pos</span><span class="o">.</span><span class="n">height</span><span class="o">*</span><span class="n">scale</span><span class="p">]</span> 
    <span class="n">npos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">x0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">npos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
    <span class="n">npos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">y0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">npos</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">npos</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

    <span class="c1"># Axis for writing text on plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$y_j = f_j(\mathbf</span><span class="si">{x}</span><span class="s1">)$&#39;</span><span class="p">,</span> 
               <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
              <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\longrightarrow$&#39;</span><span class="p">,</span> 
               <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">fontsize</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s2">&quot;nonlinear-mapping-3d-plot.svg&quot;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="non_linear_difficulty_plot_2">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.non_linear_difficulty_plot_2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">non_linear_difficulty_plot_2</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                 <span class="n">rbf_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                 <span class="n">num_basis_func</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                 <span class="n">num_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">number_across</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                 <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot a one dimensional line mapped through a two dimensional mapping.&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">two_figsize</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
        <span class="n">item</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_basis_func</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">number_across</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">num_basis_func</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dist2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">rbf_width</span><span class="o">*</span><span class="n">rbf_width</span><span class="p">))</span>
    
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Phi</span><span class="p">,</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">subx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">10</span><span class="p">,:]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">subx</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="s1">&#39;b.&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">clear_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>



    <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">F</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">F</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">10</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">10</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;b.&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">clear_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_1$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y_2$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Axis for writing text on plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="s1">&#39;$y_1 = f_1(x)$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\longrightarrow$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">fontsize</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="s1">&#39;$y_2 = f_2(x)$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;nonlinear-mapping-2d-plot.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="non_linear_difficulty_plot_1">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.non_linear_difficulty_plot_1">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">non_linear_difficulty_plot_1</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                 <span class="n">data_std</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                 <span class="n">rbf_width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                 <span class="n">num_basis_func</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                 <span class="n">number_across</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                                 <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                 <span class="n">patch_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                 <span class="n">diagrams</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot a one dimensional Gaussian pushed through an RBF network.&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Polygon</span>
    <span class="n">xsamp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">number_across</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="c1"># Create RBF network with much larger variation in functions.</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">num_basis_func</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">Phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dist2</span><span class="p">(</span><span class="n">xsamp</span><span class="p">,</span> <span class="n">mu</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">rbf_width</span><span class="o">*</span><span class="n">rbf_width</span><span class="p">))</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_basis_func</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Phi</span><span class="p">,</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">three_figsize</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">/</span><span class="n">alpha</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">)),</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">patch_color</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">clear_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$p(x)$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">data_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">data_std</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">data_std</span><span class="o">*</span><span class="n">data_std</span><span class="p">)</span><span class="o">*</span><span class="n">dist2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">data_std</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)),</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">patch_color</span><span class="p">)</span>
    <span class="n">a</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">clear_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$p(y)$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    
    <span class="c1"># Axis for writing text on plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$y = f(x) + \epsilon$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\longrightarrow$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">fontsize</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;gaussian-through-nonlinear.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">diagrams</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="network">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.network">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">network</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for drawing a neural network.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="network.__init__">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.network.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">layers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">=</span><span class="n">layers</span></div>


<div class="viewcode-block" id="network.add_layer">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.network.add_layer">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the widest layer number&quot;&quot;&quot;</span>
        <span class="n">store</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">width</span><span class="o">&gt;</span><span class="n">store</span><span class="p">:</span>
                <span class="n">store</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">width</span>
        <span class="k">return</span> <span class="n">store</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the depth of the network&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span>


<div class="viewcode-block" id="network.draw">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.network.draw">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_unit</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">node_unit</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
             <span class="n">observed_style</span><span class="o">=</span><span class="s1">&#39;shaded&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the network using daft&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">daft</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;daft module is required for this function. Please install it with: pip install daft&quot;</span><span class="p">)</span>
        
        <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">]</span>
        <span class="n">xpadding</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">ypadding</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pgm</span> <span class="o">=</span> <span class="n">daft</span><span class="o">.</span><span class="n">PGM</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">xpadding</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ypadding</span><span class="p">],</span>
                       <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> 
                       <span class="n">grid_unit</span><span class="o">=</span><span class="n">grid_unit</span><span class="p">,</span> 
                       <span class="n">node_unit</span><span class="o">=</span><span class="n">node_unit</span><span class="p">,</span> 
                       <span class="n">observed_style</span><span class="o">=</span><span class="n">observed_style</span><span class="p">,</span>
                       <span class="n">line_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>
        
        <span class="n">yoffset</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
            <span class="n">posy</span> <span class="o">=</span> <span class="n">yoffset</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>        
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
                <span class="n">xoffset</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="o">-</span><span class="n">layer</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">))</span><span class="o">+</span><span class="mf">0.5</span>
                <span class="n">posx</span> <span class="o">=</span> <span class="n">xoffset</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
                <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s1">&#39;$&#39;</span> <span class="o">+</span> <span class="n">layer</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> 
                                       <span class="n">posx</span><span class="p">,</span> <span class="n">posy</span><span class="p">,</span>
                                       <span class="n">observed</span><span class="o">=</span><span class="n">layer</span><span class="o">.</span><span class="n">observed</span><span class="p">,</span>
                                       <span class="n">fixed</span><span class="o">=</span><span class="n">layer</span><span class="o">.</span><span class="n">fixed</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
                            <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> 
                                         <span class="n">layer</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">ctx</span> <span class="o">=</span> <span class="n">pgm</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">figure</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
            <span class="n">posy</span> <span class="o">=</span> <span class="n">yoffset</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ypadding</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
            <span class="n">posx</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">xpadding</span><span class="o">/</span><span class="mi">2</span> 
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pgm</span><span class="o">.</span><span class="n">_ctx</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">posx</span><span class="p">,</span> <span class="n">posy</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                             <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                             <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>
</div>




<div class="viewcode-block" id="layer">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.layer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">layer</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for a neural network layer&quot;&quot;&quot;</span>
<div class="viewcode-block" id="layer.__init__">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.layer.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observed</span> <span class="o">=</span> <span class="n">observed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="n">fixed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span></div>
</div>



<div class="viewcode-block" id="neural_network">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.neural_network">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">neural_network</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw a neural network.&quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">network</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;x_</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;given $\mathbf</span><span class="si">{x}</span><span class="s1">$&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;h_{{1, </span><span class="si">{index}</span><span class="s1">}}&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{h}</span><span class="s1">_1=\boldsymbol{\phi}\left(\mathbf</span><span class="si">{W}</span><span class="s1">_1\mathbf</span><span class="si">{x}</span><span class="s1">\right)$&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$y=\mathbf</span><span class="si">{w}</span><span class="s1">_2^\top\mathbf</span><span class="si">{h}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">,</span>
                    <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">grid_unit</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;neural-network.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>




        
<div class="viewcode-block" id="deep_nn">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.deep_nn">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">deep_nn</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw a deep neural network.&quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">network</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;x_</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;given $\mathbf</span><span class="si">{x}</span><span class="s1">$&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;h_{{1, </span><span class="si">{index}</span><span class="s1">}}&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{h}</span><span class="s1">_1=\boldsymbol{\phi}\left(\mathbf</span><span class="si">{W}</span><span class="s1">_1\mathbf</span><span class="si">{x}</span><span class="s1">\right)$&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;h_{{2, </span><span class="si">{index}</span><span class="s1">}}&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{h}</span><span class="s1">_2=\boldsymbol{\phi}\left(\mathbf</span><span class="si">{W}</span><span class="s1">_2\mathbf</span><span class="si">{h}</span><span class="s1">_1\right)$&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;h_{{3, </span><span class="si">{index}</span><span class="s1">}}&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{h}</span><span class="s1">_3=\boldsymbol{\phi}\left(\mathbf</span><span class="si">{W}</span><span class="s1">_3\mathbf</span><span class="si">{h}</span><span class="s1">_2\right)$&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$y=\mathbf</span><span class="si">{w}</span><span class="s1">_4^\top\mathbf</span><span class="si">{h}</span><span class="s1">_3$&#39;</span><span class="p">,</span>
                    <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;deep-nn2.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">new_text</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_text</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">=</span><span class="n">text</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;deep-nn1.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



    
<div class="viewcode-block" id="deep_nn_bottleneck">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.deep_nn_bottleneck">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">deep_nn_bottleneck</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw a deep neural network with bottleneck layers.&quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">network</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;x_</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;given $\mathbf</span><span class="si">{x}</span><span class="s1">$&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;z_{{1, </span><span class="si">{index}</span><span class="s1">}}&#39;</span><span class="p">,</span>
                    <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{z}</span><span class="s1">_1 = \mathbf</span><span class="si">{V}</span><span class="s1">_1^\top\mathbf</span><span class="si">{x}</span><span class="s1">$&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;h_{{1, </span><span class="si">{index}</span><span class="s1">}}&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{h}</span><span class="s1">_1=\boldsymbol{\phi}\left(\mathbf</span><span class="si">{U}</span><span class="s1">_1\mathbf</span><span class="si">{z}</span><span class="s1">_1\right)$&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;z_{{2, </span><span class="si">{index}</span><span class="s1">}}&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{z}</span><span class="s1">_2 = \mathbf</span><span class="si">{V}</span><span class="s1">_2^\top\mathbf</span><span class="si">{h}</span><span class="s1">_1$&#39;</span><span class="p">,</span>
                    <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;h_{{2, </span><span class="si">{index}</span><span class="s1">}}&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{h}</span><span class="s1">_2=\boldsymbol{\phi}\left(\mathbf</span><span class="si">{U}</span><span class="s1">_2\mathbf</span><span class="si">{z}</span><span class="s1">_2\right)$&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;z_{{3, </span><span class="si">{index}</span><span class="s1">}}&#39;</span><span class="p">,</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{z}</span><span class="s1">_2 = \mathbf</span><span class="si">{V}</span><span class="s1">_3^\top\mathbf</span><span class="si">{h}</span><span class="s1">_2$&#39;</span><span class="p">,</span>
                    <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;h_{{3, </span><span class="si">{index}</span><span class="s1">}}&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{h}</span><span class="s1">_3=\boldsymbol{\phi}\left(\mathbf</span><span class="si">{U}</span><span class="s1">_3\mathbf</span><span class="si">{z}</span><span class="s1">_3\right)$&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$y=\mathbf</span><span class="si">{w}</span><span class="s1">_4^\top\mathbf</span><span class="si">{h}</span><span class="s1">_3$&#39;</span><span class="p">,</span>
                    <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;deep-nn-bottleneck2.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">new_text</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;input layer&#39;</span><span class="p">,</span> <span class="s1">&#39;latent layer 1&#39;</span><span class="p">,</span> <span class="s1">&#39;hidden layer 1&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;latent layer 2&#39;</span><span class="p">,</span> <span class="s1">&#39;hidden layer 2&#39;</span><span class="p">,</span> <span class="s1">&#39;latent layer 3&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;hidden layer 3&#39;</span><span class="p">,</span> <span class="s1">&#39;output layer&#39;</span><span class="p">]</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;deep-nn-bottleneck1.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_text</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">=</span><span class="n">text</span></div>



<div class="viewcode-block" id="box">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.box">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">box</span><span class="p">(</span><span class="n">lim_val</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">side_length</span><span class="o">=</span><span class="mi">25</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot a box for use in deep GP samples.&quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">lim_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">side_length</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> 
                   <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">lim_val</span><span class="p">,</span> <span class="n">lim_val</span><span class="p">,</span> <span class="n">side_length</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]))</span>
    <span class="n">tnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lim_val</span><span class="p">,</span> <span class="o">-</span><span class="n">lim_val</span><span class="p">,</span> <span class="n">side_length</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> 
                      <span class="n">lim_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">side_length</span><span class="p">,</span> <span class="mi">1</span><span class="p">))))</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">tnew</span><span class="p">))</span>
    <span class="n">tnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="o">-</span><span class="n">lim_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">side_length</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> 
                      <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lim_val</span><span class="p">,</span> <span class="o">-</span><span class="n">lim_val</span><span class="p">,</span> <span class="n">side_length</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]))</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">tnew</span><span class="p">))</span>
    <span class="n">tnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">lim_val</span><span class="p">,</span> <span class="n">lim_val</span><span class="p">,</span> <span class="n">side_length</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> 
                   <span class="o">-</span><span class="n">lim_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">side_length</span><span class="p">,</span> <span class="mi">1</span><span class="p">))))</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">tnew</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">t</span></div>


<div class="viewcode-block" id="stack_gp_sample">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.stack_gp_sample">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">stack_gp_sample</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">latent_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">side_length</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">lim_val</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">num_samps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">1.4</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                    <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw a sample from a deep Gaussian process.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">kernel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">GPy</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GPy unavailable, see https://github.com/SheffieldML/GPy pip install GPy&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">kernel</span><span class="o">=</span><span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span>
    
    
    <span class="n">depth</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">latent_dims</span><span class="p">)</span>
    <span class="n">num_time</span> <span class="o">=</span> <span class="n">side_length</span><span class="o">*</span><span class="mi">4</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">lim_val</span><span class="o">=</span><span class="n">lim_val</span><span class="p">,</span> <span class="n">side_length</span><span class="o">=</span><span class="n">side_length</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">latent_dims</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samps</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">kern</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">K</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span>
            <span class="n">kern</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kernel</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">K</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kern</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_time</span><span class="p">)),</span> 
                                                     <span class="n">cov</span><span class="o">=</span><span class="n">K</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">latent_dims</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>


        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span>
            <span class="c1">#pos = ax[j].get_position()</span>
            <span class="c1">#ax[j].set_position((pos.x0, pos.y0, </span>
            <span class="c1">#                    pos.width/2, pos.height))</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="mf">1.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">lim_val</span><span class="p">,</span> <span class="n">lim_val</span><span class="p">]))</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="mf">1.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">lim_val</span><span class="p">,</span> <span class="n">lim_val</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="mf">1.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="mf">1.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;stack-gp-sample-&#39;</span> <span class="o">+</span> <span class="n">kern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.svg&#39;</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span>
                          <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                          <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                          <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">pos</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">pos</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">pos</span><span class="o">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">pos</span><span class="o">.</span><span class="n">height</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="mf">1.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">lim_val</span><span class="p">,</span> <span class="n">lim_val</span><span class="p">]))</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="mf">1.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">lim_val</span><span class="p">,</span> <span class="n">lim_val</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="mf">1.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="mf">1.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">],</span> 
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> 
                             <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">],</span> 
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;stack-gp-sample-squash-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.svg&#39;</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                              <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                              <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="vertical_chain">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.vertical_chain">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">vertical_chain</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">grid_unit</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">node_unit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a verticle chain representation of a deep GP&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">daft</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;daft module is required for this function. Please install it with: pip install daft&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">node_unit</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">node_unit</span><span class="o">+</span><span class="n">depth</span><span class="p">]</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">node_unit</span><span class="p">]</span>

    <span class="n">pgm</span> <span class="o">=</span> <span class="n">daft</span><span class="o">.</span><span class="n">PGM</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                   <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                   <span class="n">grid_unit</span><span class="o">=</span><span class="n">grid_unit</span><span class="p">,</span> 
                   <span class="n">node_unit</span><span class="o">=</span><span class="n">node_unit</span><span class="p">,</span> 
                   <span class="n">observed_style</span><span class="o">=</span><span class="s1">&#39;shaded&#39;</span><span class="p">,</span>
                  <span class="n">line_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>

    <span class="n">node</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{x}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">node</span>
        <span class="n">node</span><span class="o">=</span><span class="s2">&quot;f_</span><span class="si">{index}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf{{f}}_</span><span class="si">{index}</span><span class="s2">$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                               <span class="mf">0.5</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

    <span class="n">last</span> <span class="o">=</span> <span class="n">node</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">target</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{y}</span><span class="s2">$&quot;</span><span class="p">,</span> 
                           <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pgm</span></div>


<div class="viewcode-block" id="horizontal_chain">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.horizontal_chain">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">horizontal_chain</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                     <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="n">grid_unit</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                     <span class="n">node_unit</span><span class="o">=</span><span class="mf">1.9</span><span class="p">,</span>
                     <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot a horizontal Markov chain.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">daft</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;daft module is required for this function. Please install it with: pip install daft&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">node_unit</span><span class="o">+</span><span class="n">depth</span><span class="p">,</span> <span class="n">node_unit</span><span class="p">]</span>
    
    <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">node_unit</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    
    <span class="n">pgm</span> <span class="o">=</span> <span class="n">daft</span><span class="o">.</span><span class="n">PGM</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                   <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> 
                   <span class="n">grid_unit</span><span class="o">=</span><span class="n">grid_unit</span><span class="p">,</span> 
                   <span class="n">node_unit</span><span class="o">=</span><span class="n">node_unit</span><span class="p">,</span> 
                   <span class="n">observed_style</span><span class="o">=</span><span class="s1">&#39;shaded&#39;</span><span class="p">,</span>
                  <span class="n">line_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>

    <span class="n">node</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{x}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span>
        <span class="n">last</span><span class="o">=</span><span class="n">node</span>
        <span class="n">node</span> <span class="o">=</span> <span class="s2">&quot;f_</span><span class="si">{index}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf{{f}}_</span><span class="si">{index}</span><span class="s2">$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> 
                               <span class="n">i</span><span class="o">+</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">node</span>
    <span class="n">node</span><span class="o">=</span><span class="n">target</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{y}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">depth</span><span class="o">+</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pgm</span></div>


<div class="viewcode-block" id="shared_gplvm">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.shared_gplvm">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">shared_gplvm</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot graphical model of a Shared GP-LVM&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">daft</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;daft module is required for this function. Please install it with: pip install daft&quot;</span><span class="p">)</span>
    
    <span class="n">pgm</span> <span class="o">=</span> <span class="n">daft</span><span class="o">.</span><span class="n">PGM</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                   <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                   <span class="n">grid_unit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                   <span class="n">node_unit</span><span class="o">=</span><span class="mf">1.9</span><span class="p">,</span> 
                   <span class="n">observed_style</span><span class="o">=</span><span class="s1">&#39;shaded&#39;</span><span class="p">,</span>
                  <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{t}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{X}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;Z_1&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{Z}</span><span class="s2">_1$&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;Z_2&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{Z}</span><span class="s2">_2$&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;Y_1&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{Y}</span><span class="s2">_1$&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;Y_2&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{Y}</span><span class="s2">_2$&quot;</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">)</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y_1&quot;</span><span class="p">)</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y_2&quot;</span><span class="p">)</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;Z_1&quot;</span><span class="p">,</span> <span class="s2">&quot;Y_1&quot;</span><span class="p">)</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;Z_2&quot;</span><span class="p">,</span> <span class="s2">&quot;Y_2&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pgm</span></div>


<div class="viewcode-block" id="ppca_graphical_model">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.ppca_graphical_model">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ppca_graphical_model</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot graphical model of Probabilistic Principal Component Analysis (PPCA).</span>
<span class="sd">    </span>
<span class="sd">    The model shows:</span>
<span class="sd">    - Y: Observed data (grayed/shaded)</span>
<span class="sd">    - X: Latent variables (white)</span>
<span class="sd">    - W: Weight matrix parameter (black dot)</span>
<span class="sd">    - : Noise variance parameter (black dot)</span>
<span class="sd">    </span>
<span class="sd">    Layout:</span>
<span class="sd">    - Y is at the center</span>
<span class="sd">    - X is above Y at -30 angle</span>
<span class="sd">    - W is above Y at +30 angle  </span>
<span class="sd">    -  is to the right of Y</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">daft</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;daft module is required for this function. Please install it with: pip install daft&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the graphical model</span>
    <span class="n">pgm</span> <span class="o">=</span> <span class="n">daft</span><span class="o">.</span><span class="n">PGM</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span>
                   <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                   <span class="n">grid_unit</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> 
                   <span class="n">node_unit</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
                   <span class="n">observed_style</span><span class="o">=</span><span class="s1">&#39;shaded&#39;</span><span class="p">,</span>
                   <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Central observed node Y</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{Y}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    
    <span class="c1"># Latent node X above at -30 angle</span>
    <span class="c1"># Position: slightly left and above Y</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{X}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># Weight parameter W above at +30 angle  </span>
    <span class="c1"># Position: slightly right and above Y</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{W}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    
    <span class="c1"># Noise variance parameter  to the right</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;sigma2&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\sigma^2$&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    
    <span class="c1"># Add edges</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>  <span class="c1"># X influences Y</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>  <span class="c1"># W influences Y  </span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;sigma2&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>  <span class="c1">#  influences Y</span>
    
    <span class="c1"># Render and save</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">pgm</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;ppca-graphical-model.svg&#39;</span><span class="p">,</span> 
                    <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> 
                    <span class="n">figure</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> 
                    <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pgm</span></div>


<div class="viewcode-block" id="dppca_graphical_model">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.dppca_graphical_model">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">dppca_graphical_model</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot graphical model of Dual Probabilistic Principal Component Analysis (DPPCA).</span>
<span class="sd">    </span>
<span class="sd">    The model shows:</span>
<span class="sd">    - Y: Observed data (grayed/shaded)</span>
<span class="sd">    - X: Latent variables (white)</span>
<span class="sd">    - W: Weight matrix parameter (black dot)</span>
<span class="sd">    - : Noise variance parameter (black dot)</span>
<span class="sd">    </span>
<span class="sd">    Layout:</span>
<span class="sd">    - Y is at the center</span>
<span class="sd">    - X is above Y at -30 angle</span>
<span class="sd">    - W is above Y at +30 angle  </span>
<span class="sd">    -  is to the right of Y</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">daft</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;daft module is required for this function. Please install it with: pip install daft&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the graphical model</span>
    <span class="n">pgm</span> <span class="o">=</span> <span class="n">daft</span><span class="o">.</span><span class="n">PGM</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span>
                   <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                   <span class="n">grid_unit</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> 
                   <span class="n">node_unit</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
                   <span class="n">observed_style</span><span class="o">=</span><span class="s1">&#39;shaded&#39;</span><span class="p">,</span>
                   <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Central observed node Y</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{Y}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    
    <span class="c1"># Latent node X above at -30 angle</span>
    <span class="c1"># Position: slightly left and above Y</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{X}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    
    <span class="c1"># Weight parameter W above at +30 angle  </span>
    <span class="c1"># Position: slightly right and above Y</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf</span><span class="si">{W}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># Noise variance parameter  to the right</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;sigma2&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\sigma^2$&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    
    <span class="c1"># Add edges</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>  <span class="c1"># X influences Y</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>  <span class="c1"># W influences Y  </span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;sigma2&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>  <span class="c1">#  influences Y</span>
    
    <span class="c1"># Render and save</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">pgm</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;dppca-graphical-model.svg&#39;</span><span class="p">,</span> 
                    <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> 
                    <span class="n">figure</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> 
                    <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pgm</span></div>


<div class="viewcode-block" id="three_pillars_innovation">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.three_pillars_innovation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">three_pillars_innovation</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;./diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot graphical model of three pillars of successful innovation&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">daft</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;daft module is required for this function. Please install it with: pip install daft&quot;</span><span class="p">)</span>
    
    <span class="n">pgm</span> <span class="o">=</span> <span class="n">daft</span><span class="o">.</span><span class="n">PGM</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span>
                   <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                   <span class="n">grid_unit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                   <span class="n">node_unit</span><span class="o">=</span><span class="mf">4.2</span><span class="p">,</span> 
                   <span class="n">observed_style</span><span class="o">=</span><span class="s1">&#39;shaded&#39;</span><span class="p">,</span>
                   <span class="n">line_width</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
    <span class="n">orig_font_size</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span>
    <span class="n">orig_font_weight</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.weight&#39;</span><span class="p">]</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">aspect</span><span class="o">=</span><span class="mi">2</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;innovate&quot;</span><span class="p">,</span> <span class="s2">&quot;innovate&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">pgm</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;three-pillars-innovation001.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;resolve&quot;</span><span class="p">,</span> <span class="s2">&quot;resolve&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">))</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;resolve&quot;</span><span class="p">,</span> <span class="s2">&quot;innovate&quot;</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">pgm</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;three-pillars-innovation002.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">daft</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;deploy&quot;</span><span class="p">,</span> <span class="s2">&quot;deploy&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">))</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;innovate&quot;</span><span class="p">,</span> <span class="s2">&quot;deploy&quot;</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;deploy&quot;</span><span class="p">,</span> <span class="s2">&quot;resolve&quot;</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">pgm</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;three-pillars-innovation003.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">orig_font_size</span><span class="p">)</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">orig_font_weight</span><span class="p">)</span></div>



<div class="viewcode-block" id="model_output">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.model_output">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">model_output</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">portion</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the output of a GP.</span>
<span class="sd">    :param model: the model for the output plotting.</span>
<span class="sd">    :param output_dim: the output dimension to plot.</span>
<span class="sd">    :param scale: how to scale the output.</span>
<span class="sd">    :param offset: how to offset the output.</span>
<span class="sd">    :param ax: axis to plot on.</span>
<span class="sd">    :param xlabel: label for the x axis (default: &#39;$x$&#39;).</span>
<span class="sd">    :param ylabel: label for the y axis (default: &#39;$y$&#39;).</span>
<span class="sd">    :param xlim: limits of the x axis</span>
<span class="sd">    :param ylim: limits of the y axis</span>
<span class="sd">    :param fontsize: fontsize (default 20)</span>
<span class="sd">    :param portion: What proportion of the input range to put outside the data.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">big_figsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">xt</span> <span class="o">=</span> <span class="n">pred_range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">portion</span><span class="o">=</span><span class="n">portion</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xt</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xt</span><span class="o">.</span><span class="n">flatten</span><span class="p">())]</span>

    <span class="n">yt_mean</span><span class="p">,</span> <span class="n">yt_var</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span>
    <span class="n">yt_mean</span> <span class="o">=</span> <span class="n">yt_mean</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">offset</span>
    <span class="n">yt_var</span> <span class="o">*=</span> <span class="n">scale</span><span class="o">*</span><span class="n">scale</span>
    <span class="n">yt_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">yt_var</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yt_sd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">yt_sd</span> <span class="o">=</span> <span class="n">yt_sd</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">GPY_AVAILABLE</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">mlai.gp_tutorial</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpt</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">gpt</span><span class="o">.</span><span class="n">gpplot</span><span class="p">(</span><span class="n">xt</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                           <span class="n">yt_mean</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">],</span>
                           <span class="n">yt_mean</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">yt_sd</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                           <span class="n">yt_mean</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">yt_sd</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                           <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xt</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">yt_mean</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xt</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                       <span class="p">(</span><span class="n">yt_mean</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">yt_sd</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                       <span class="p">(</span><span class="n">yt_mean</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">yt_sd</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                       <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylim</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;k^&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="s1">&#39;20&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="model_sample">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.model_sample">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">model_sample</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">samps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> 
                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">portion</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                 <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot model output with samples.&quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">big_figsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    
    <span class="n">xt</span> <span class="o">=</span> <span class="n">pred_range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">portion</span><span class="o">=</span><span class="n">portion</span><span class="p">)</span>
    <span class="n">yt_mean</span><span class="p">,</span> <span class="n">yt_var</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span>
    <span class="n">yt_mean</span> <span class="o">=</span> <span class="n">yt_mean</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">offset</span>
    <span class="n">yt_var</span> <span class="o">*=</span> <span class="n">scale</span><span class="o">*</span><span class="n">scale</span>
    <span class="n">yt_sd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">yt_var</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yt_sd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">yt_sd</span> <span class="o">=</span> <span class="n">yt_sd</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span>
        
    <span class="k">if</span> <span class="n">GPY_AVAILABLE</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">mlai.gp_tutorial</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpt</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">gpt</span><span class="o">.</span><span class="n">gpplot</span><span class="p">(</span><span class="n">xt</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                   <span class="n">yt_mean</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">],</span>
                   <span class="n">yt_mean</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">yt_sd</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                   <span class="n">yt_mean</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">yt_sd</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                   <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xt</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">yt_mean</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xt</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                       <span class="p">(</span><span class="n">yt_mean</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">yt_sd</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                       <span class="p">(</span><span class="n">yt_mean</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">yt_sd</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                       <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samps</span><span class="p">):</span>
        <span class="n">xt</span> <span class="o">=</span> <span class="n">pred_range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">portion</span><span class="o">=</span><span class="n">portion</span><span class="p">,</span> <span class="n">randomize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">posterior_sample</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xt</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">a</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span><span class="o">*</span><span class="n">scale</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;b.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[:,</span> <span class="n">output_dim</span><span class="p">]</span><span class="o">*</span><span class="n">scale</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xt</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xt</span><span class="o">.</span><span class="n">flatten</span><span class="p">())])</span>
    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
               
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">):</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="multiple_optima">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.multiple_optima">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">multiple_optima</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gene_number</span><span class="o">=</span><span class="mi">937</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">model_restarts</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">max_iters</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;./diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Show an example of a multimodal error surface for Gaussian process</span>
<span class="sd">    regression. Gene 937 has bimodal behaviour where the noisy mode is</span>
<span class="sd">    higher.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">one_figsize</span><span class="p">)</span>

    <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
    <span class="c1"># Contour over a range of length scales and signal/noise ratios.</span>
    <span class="n">log_SNRs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="n">length_scales</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resolution</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pods</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pods unavailable, see https://github.com/sods/ods for example datasets&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pods</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">della_gatta_TRP63_gene_expression</span><span class="p">(</span><span class="n">data_set</span><span class="o">=</span><span class="s1">&#39;della_gatta&#39;</span><span class="p">,</span><span class="n">gene_number</span><span class="o">=</span><span class="n">gene_number</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">var</span><span class="p">())</span>

    <span class="n">yhat</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">GPy</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GPy unavailable, see https://github.com/SheffieldML/GPy pip install GPy&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">lengthscale</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">GPRegression</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">)</span>
    <span class="n">lls</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">contour_data</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">length_scales</span><span class="p">,</span> <span class="n">log_SNRs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">log_SNRs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lls</span><span class="p">),</span> <span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
    <span class="c1">#ax.set_xscale(&#39;log&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;length scale&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">$ SNR&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;multiple-optima000.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    

    <span class="c1"># Now run a few optimizations</span>
    <span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">optim_point_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">optim_point_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">noises</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">]</span>
    <span class="n">lengthscales</span> <span class="o">=</span> <span class="p">[</span><span class="mf">50.</span><span class="p">,</span> <span class="mf">2000.</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span> 
    <span class="k">for</span> <span class="n">noise</span><span class="p">,</span> <span class="n">lengthscale</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">noises</span><span class="p">,</span> <span class="n">lengthscales</span><span class="p">):</span>
        <span class="n">kern</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lengthscale</span><span class="o">=</span><span class="n">lengthscale</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">GPRegression</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="n">kern</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">noise</span>
        <span class="n">optim_point_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">rbf</span><span class="o">.</span><span class="n">lengthscale</span>
        <span class="n">optim_point_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">rbf</span><span class="o">.</span><span class="n">variance</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">variance</span><span class="p">);</span>

        <span class="c1"># optimize</span>
        <span class="k">if</span> <span class="n">optimize</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

        <span class="n">optim_point_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">rbf</span><span class="o">.</span><span class="n">lengthscale</span>
        <span class="n">optim_point_y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">rbf</span><span class="o">.</span><span class="n">variance</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">variance</span><span class="p">);</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Arrow</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">optim_point_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">optim_point_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">optim_point_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">optim_point_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">optim_point_y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">optim_point_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">head_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">head_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;multiple-optima001.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                      <span class="n">figure</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">lls</span> </div>



<span class="c1"># def rotate_object(rotation_matrix, handles):</span>
<span class="c1">#     &quot;&quot;&quot;Rotate an object in an image&quot;&quot;&quot;</span>
<span class="c1">#     for i in handles:</span>
<span class="c1"># 	if type(handle) is text:</span>
<span class="c1">#             handle.get(&#39;position&#39;)</span>
<span class="c1">#             xy[0:1] = np.dot(rotation_matrix,xy[0:1].T)</span>
<span class="c1">#             handle.set(&#39;position&#39;, xy)</span>
<span class="c1">#         else:</span>
<span class="c1">#             xd = handle.get(&#39;xdata&#39;)</span>
<span class="c1">#             yd = handle.get(&#39;ydata&#39;)</span>
<span class="c1">#             new = np.dot(rotation_matrix,np.column_stack((xd[:].T, yd[:].T)))</span>
<span class="c1">#             handle.set(&#39;xdata&#39;, new[0, :])</span>
<span class="c1">#             handle.set(&#39;ydata&#39;, new[1, :])</span>

<div class="viewcode-block" id="google_trends">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.google_trends">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">google_trends</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">initials</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;./diagrams&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot google trends data for a number of different terms.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pods</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.dates</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mdates</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pods</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">google_trends</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data frame&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">wide_figsize</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data frame&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">initials</span><span class="o">+</span><span class="s1">&#39;-google-trends.svg&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">handles</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">handle</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">:</span>
        <span class="n">handle</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">handles</span><span class="p">):</span>
        <span class="n">handle</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{initials}</span><span class="s1">-google-trends</span><span class="si">{sample:0&gt;3}</span><span class="s1">.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initials</span><span class="o">=</span><span class="n">initials</span><span class="p">,</span><span class="n">sample</span><span class="o">=</span><span class="n">i</span><span class="p">),</span>
                          <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                          <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="gp_optimize_quadratic">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.gp_optimize_quadratic">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gp_optimize_quadratic</span><span class="p">(</span><span class="n">lambda1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">lambda2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                         <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">,</span> 
                         <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                         <span class="n">plot_width</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                         <span class="n">generate_frames</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create animated visualization of GP optimization quadratic data fit term.</span>
<span class="sd">    </span>
<span class="sd">    This function replaces the MATLAB code that generates animated LaTeX diagrams</span>
<span class="sd">    showing the quadratic data fit term $\frac{\mathbf{y}^\top\mathbf{K}^{-1}\mathbf{y}}{2}$</span>
<span class="sd">    with elliptical contours and eigenvalue visualization.</span>
<span class="sd">    </span>
<span class="sd">    :param lambda1: First eigenvalue of covariance matrix (default: 3).</span>
<span class="sd">    :param lambda2: Second eigenvalue of covariance matrix (default: 1).</span>
<span class="sd">    :param directory: Directory to save the plots (default: &#39;../diagrams&#39;).</span>
<span class="sd">    :param fontsize: Font size for labels (default: 20).</span>
<span class="sd">    :param plot_width: Relative width for LaTeX integration (default: 0.6).</span>
<span class="sd">    :param generate_frames: Whether to generate all 3 animation frames (default: True).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    
    <span class="c1"># Color definitions</span>
    <span class="n">black_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
    <span class="n">red_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
    
    <span class="c1"># Create figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    
    <span class="c1"># Generate elliptical contours</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    
    <span class="c1"># Create rotation matrix (45 degrees)</span>
    <span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> 
                  <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]])</span>
    
    <span class="c1"># Set up plot limits</span>
    <span class="n">lim_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lambda1</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.2</span>
    <span class="n">lim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">lim_val</span><span class="p">,</span> <span class="n">lim_val</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    
    <span class="c1"># Generate elliptical contours</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lambda1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">lambda2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)])</span>
    <span class="n">xy_outer</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xy</span>  <span class="c1"># Outer contour</span>
    
    <span class="c1"># Frame 0: Initial contours with eigenvalue axes</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    
    <span class="c1"># Plot contours</span>
    <span class="n">contour_handles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">contour_handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="n">black_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">contour_handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy_outer</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">xy_outer</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="n">red_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="c1"># Add eigenvalue arrows</span>
    <span class="n">arrow_handles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">arrow_handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lambda1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> 
                                 <span class="n">fc</span><span class="o">=</span><span class="n">black_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">black_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">arrow_handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> 
                                 <span class="n">fc</span><span class="o">=</span><span class="n">black_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">black_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
    
    <span class="c1"># Add eigenvalue labels</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">xspan</span> <span class="o">=</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yspan</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">eig_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">eig_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">lambda1</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">yspan</span><span class="o">*</span><span class="mf">0.05</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\lambda_1$&#39;</span><span class="p">,</span> 
                             <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">))</span>
    <span class="n">eig_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="n">xspan</span><span class="p">,</span> <span class="n">lambda2</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\lambda_2$&#39;</span><span class="p">,</span> 
                             <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">))</span>
    
    <span class="c1"># Add axis labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y_1$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y_2$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    
    <span class="c1"># Remove box and add border lines</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">ylim</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">black_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlim</span><span class="p">,</span> <span class="p">[</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="n">black_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Save frame 0</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;gp-optimise-quadratic000.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">generate_frames</span><span class="p">:</span>
        <span class="c1"># Frame 1: Add data point</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">])</span>
        <span class="n">data_handle</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
                             <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">black_color</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;gp-optimise-quadratic001.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Frame 2: Rotated coordinate system</span>
        <span class="c1"># Apply rotation to all elements</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrow_handles</span><span class="p">):</span>
            <span class="c1"># Get arrow properties and rotate</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># First arrow (lambda1)</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lambda1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Second arrow (lambda2)</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">])</span>
            
            <span class="c1"># Rotate arrow endpoints</span>
            <span class="n">start_rot</span> <span class="o">=</span> <span class="n">R</span> <span class="o">@</span> <span class="n">start</span>
            <span class="n">end_rot</span> <span class="o">=</span> <span class="n">R</span> <span class="o">@</span> <span class="n">end</span>
            
            <span class="c1"># Remove old arrow and create new one</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="n">arrow_handles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">start_rot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">start_rot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                       <span class="n">end_rot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_rot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end_rot</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_rot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">head_width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> 
                                       <span class="n">fc</span><span class="o">=</span><span class="n">black_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">black_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="c1"># Rotate contours</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">contour_handles</span><span class="p">):</span>
            <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
            <span class="n">xy_rot</span> <span class="o">=</span> <span class="n">R</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">])</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">xy_rot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">xy_rot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
        
        <span class="c1"># Rotate eigenvalue labels</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eig_labels</span><span class="p">):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
            <span class="n">pos_rot</span> <span class="o">=</span> <span class="n">R</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
            <span class="n">label</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">pos_rot</span><span class="p">)</span>
                
        <span class="c1"># Update axis labels for rotated view</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y_1$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y_2$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        
        <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="s1">&#39;gp-optimise-quadratic002.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">ax</span></div>





<div class="viewcode-block" id="tsne_example">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.tsne_example">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">tsne_example</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">perplexities</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot t-SNE embeddings with different perplexity values&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.manifold</span><span class="w"> </span><span class="kn">import</span> <span class="n">TSNE</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">perplexities</span><span class="p">),</span> 
                            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">perplexities</span><span class="p">),</span> <span class="mi">5</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">perplexity</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">perplexities</span><span class="p">):</span>
        <span class="n">tsne</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">perplexity</span><span class="o">=</span><span class="n">perplexity</span><span class="p">,</span> 
                    <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="n">X_tsne</span> <span class="o">=</span> <span class="n">tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> 
                  <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Perplexity = </span><span class="si">{</span><span class="n">perplexity</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>





<div class="viewcode-block" id="squared_distances">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.squared_distances">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">squared_distances</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">shortname</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;./diagrams&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot squared distances between points in Y&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">wide_figsize</span>
    
    <span class="c1"># Compute pairwise squared distances</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.spatial.distance</span><span class="w"> </span><span class="kn">import</span> <span class="n">pdist</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">pdist</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;sqeuclidean&#39;</span><span class="p">)</span>
    
    <span class="c1"># Create histogram</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    
    <span class="c1"># Theoretical gamma distribution</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">gamma</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># dimension</span>
    <span class="n">mean_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
    <span class="n">x_theory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">distances</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">gamma_pdf</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_theory</span><span class="p">,</span> <span class="n">d</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">mean_dist</span><span class="o">/</span><span class="n">d</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_theory</span><span class="p">,</span> <span class="n">gamma_pdf</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Squared Distance&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">shortname</span><span class="si">}</span><span class="s1">_squared-distances.svg&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="visualise_relu_activations">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.visualise_relu_activations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">visualise_relu_activations</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">layer_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;relu-activations.svg&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualise which ReLU units are activated in a specific layer.</span>
<span class="sd">    </span>
<span class="sd">    This function creates a grid of subplots showing the activation patterns</span>
<span class="sd">    of each ReLU unit in a neural network layer. Each subplot shows where</span>
<span class="sd">    that particular unit is active (positive output) vs inactive (zero output).</span>
<span class="sd">    </span>
<span class="sd">    :param nn: Trained neural network</span>
<span class="sd">    :type nn: NeuralNetwork</span>
<span class="sd">    :param X1, X2: Meshgrid coordinates for visualisation</span>
<span class="sd">    :type X1, X2: numpy.ndarray</span>
<span class="sd">    :param layer_idx: Which hidden layer to visualise (0-indexed)</span>
<span class="sd">    :type layer_idx: int</span>
<span class="sd">    :returns: Figure object</span>
<span class="sd">    :rtype: matplotlib.figure.Figure</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; x1 = np.linspace(-2, 2, 50)</span>
<span class="sd">        &gt;&gt;&gt; x2 = np.linspace(-2, 2, 50)</span>
<span class="sd">        &gt;&gt;&gt; X1, X2 = np.meshgrid(x1, x2)</span>
<span class="sd">        &gt;&gt;&gt; nn = NeuralNetwork([2, 10, 1], [ReLUActivation(), LinearActivation()])</span>
<span class="sd">        &gt;&gt;&gt; fig = visualise_relu_activations(nn, X1, X2, layer_idx=0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get input data</span>
    <span class="n">X_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">X1</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">X2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]])</span>
    
    <span class="c1"># Forward pass to get activations</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">)</span>
    
    <span class="c1"># Get activations for the specified layer (before activation function)</span>
    <span class="n">z_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">layer_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># +1 because z[0] is input</span>
    <span class="n">a_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">layer_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Activations after ReLU</span>
    
    <span class="n">n_units</span> <span class="o">=</span> <span class="n">z_layer</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_units</span><span class="p">)</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_units</span> <span class="o">+</span> <span class="n">n_cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">n_cols</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">n_cols</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">n_rows</span><span class="p">))</span>
    
    <span class="c1"># Handle different subplot configurations</span>
    <span class="k">if</span> <span class="n">n_units</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Single subplot case</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axes</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">n_rows</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n_cols</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Single row, multiple columns</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n_rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n_cols</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Multiple rows, single column</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># For multiple rows and columns, axes is already correct</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_units</span><span class="p">):</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="n">n_cols</span>
        <span class="k">if</span> <span class="n">n_units</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">n_rows</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">n_cols</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
        
        <span class="c1"># Reshape activations back to grid</span>
        <span class="n">activation_grid</span> <span class="o">=</span> <span class="n">a_layer</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        
        <span class="c1"># Create binary mask for active/inactive regions</span>
        <span class="n">active_mask</span> <span class="o">=</span> <span class="n">activation_grid</span> <span class="o">&gt;</span> <span class="mi">0</span>
        
        <span class="c1"># Plot with clear active/inactive distinction</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">activation_grid</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu_r&#39;</span><span class="p">)</span>
        
        <span class="c1"># Overlay contour lines to show zero boundary</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">activation_grid</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">)</span>
        
        <span class="c1"># Add colorbar for each subplot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    
    <span class="c1"># Hide empty subplots</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_units</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="n">n_cols</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n_units</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># No empty subplots to hide in single unit case</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">n_rows</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">n_cols</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="n">n_cols</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ReLU Activations - Layer </span><span class="si">{</span><span class="n">layer_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="visualise_activation_summary">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.visualise_activation_summary">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">visualise_activation_summary</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">layer_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;activation-summary.svg&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a summary visualisation showing network behavior.</span>
<span class="sd">    </span>
<span class="sd">    This function creates a 3-panel visualization showing:</span>
<span class="sd">    1. Network output</span>
<span class="sd">    2. Number of active ReLUs per point</span>
<span class="sd">    3. Binary activation pattern</span>
<span class="sd">    </span>
<span class="sd">    :param nn: Trained neural network</span>
<span class="sd">    :type nn: NeuralNetwork</span>
<span class="sd">    :param X1, X2: Meshgrid coordinates for visualization</span>
<span class="sd">    :type X1, X2: numpy.ndarray</span>
<span class="sd">    :param layer_idx: Which hidden layer to visualize (0-indexed)</span>
<span class="sd">    :type layer_idx: int</span>
<span class="sd">    :returns: Figure object</span>
<span class="sd">    :rtype: matplotlib.figure.Figure</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; x1 = np.linspace(-2, 2, 50)</span>
<span class="sd">        &gt;&gt;&gt; x2 = np.linspace(-2, 2, 50)</span>
<span class="sd">        &gt;&gt;&gt; X1, X2 = np.meshgrid(x1, x2)</span>
<span class="sd">        &gt;&gt;&gt; nn = NeuralNetwork([2, 10, 1], [ReLUActivation(), LinearActivation()])</span>
<span class="sd">        &gt;&gt;&gt; fig = visualize_activation_summary(nn, X1, X2, layer_idx=0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListedColormap</span>
    
    <span class="n">X_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">X1</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">X2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]])</span>
    
    <span class="c1"># Get network output and activations</span>
    <span class="n">f_pred</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">)</span>
    <span class="n">a_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">layer_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Activations after ReLU</span>
    
    <span class="c1"># Count active units per input point</span>
    <span class="n">active_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a_layer</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    
    <span class="c1"># 1. Network output</span>
    <span class="n">im1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">f_pred</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Network Output&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="c1"># 2. Number of active ReLUs</span>
    <span class="n">im2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">active_count</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> 
                          <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">active_count</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Number of Active ReLU Units&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="c1"># 3. Activation patterns (binary)</span>
    <span class="c1"># Create a custom colormap for binary visualization</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="s1">&#39;lightcoral&#39;</span><span class="p">]</span>
    <span class="n">binary_cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
    
    <span class="c1"># Average activation strength (normalized)</span>
    <span class="n">avg_activation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">a_layer</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">binary_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">avg_activation</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    
    <span class="n">im3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">binary_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> 
                          <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">binary_cmap</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Average Activation Pattern</span><span class="se">\n</span><span class="s1">(Blue=Inactive, Red=Active)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>




<div class="viewcode-block" id="visualise_decision_boundaries">
<a class="viewcode-back" href="../../api/plot.html#mlai.plot.visualise_decision_boundaries">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">visualise_decision_boundaries</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">layer_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../diagrams&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;decision-boundaries.svg&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize the linear decision boundaries created by each ReLU unit.</span>
<span class="sd">    </span>
<span class="sd">    This function shows the linear decision boundaries (where each ReLU unit</span>
<span class="sd">    transitions from inactive to active) overlaid on the network&#39;s output.</span>
<span class="sd">    </span>
<span class="sd">    :param nn: Trained neural network</span>
<span class="sd">    :type nn: NeuralNetwork</span>
<span class="sd">    :param X1, X2: Meshgrid coordinates for visualization</span>
<span class="sd">    :type X1, X2: numpy.ndarray</span>
<span class="sd">    :param layer_idx: Which hidden layer to visualize (0-indexed)</span>
<span class="sd">    :type layer_idx: int</span>
<span class="sd">    :returns: Figure object</span>
<span class="sd">    :rtype: matplotlib.figure.Figure</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; x1 = np.linspace(-2, 2, 50)</span>
<span class="sd">        &gt;&gt;&gt; x2 = np.linspace(-2, 2, 50)</span>
<span class="sd">        &gt;&gt;&gt; X1, X2 = np.meshgrid(x1, x2)</span>
<span class="sd">        &gt;&gt;&gt; nn = NeuralNetwork([2, 10, 1], [ReLUActivation(), LinearActivation()])</span>
<span class="sd">        &gt;&gt;&gt; fig = visualize_decision_boundaries(nn, X1, X2, layer_idx=0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">X1</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">X2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]])</span>
    
    <span class="c1"># Get pre-activation values (before ReLU)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">)</span>
    <span class="n">z_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">layer_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    
    <span class="n">n_units</span> <span class="o">=</span> <span class="n">z_layer</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">big_figsize</span><span class="p">)</span>
    
    <span class="c1"># Plot decision boundary for each unit</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_units</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_units</span><span class="p">):</span>
        <span class="n">z_grid</span> <span class="o">=</span> <span class="n">z_layer</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        
        <span class="c1"># Plot the zero-level contour (decision boundary)</span>
        <span class="n">contour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">z_grid</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                           <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        
        <span class="c1"># Label the contour - check if contour has any paths</span>
        <span class="k">if</span> <span class="n">contour</span><span class="o">.</span><span class="n">get_paths</span><span class="p">():</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Unit </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="c1"># Also show regions where network output is positive/negative</span>
    <span class="n">f_pred</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">f_pred</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> 
               <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="s1">&#39;lightcoral&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ReLU Decision Boundaries</span><span class="se">\n</span><span class="s1">(Background: Network Output Sign)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">ma</span><span class="o">.</span><span class="n">write_figure</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2025, Neil D. Lawrence.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>